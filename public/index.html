<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI 단어 암기장 - 무제한 AI 생성</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .flip-card {
      perspective: 1000px;
    }
    .flip-card-inner {
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .flip-card.flipped .flip-card-inner {
      transform: rotateY(180deg);
    }
    .flip-card-front, .flip-card-back {
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }
    .flip-card-back {
      transform: rotateY(180deg);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function VocabApp() {
      // LocalStorage에서 불러오기
      const loadFromStorage = () => {
        try {
          const saved = localStorage.getItem('vocabWords');
          if (saved) {
            return JSON.parse(saved);
          }
        } catch (error) {
          console.error('데이터 로드 오류:', error);
        }
        return [];
      };

      // 학습 기록 로드
      const loadStudyHistory = () => {
        try {
          const saved = localStorage.getItem('studyHistory');
          if (saved) {
            return JSON.parse(saved);
          }
        } catch (error) {
          console.error('학습 기록 로드 오류:', error);
        }
        return {};
      };

      const [words, setWords] = useState(loadFromStorage);
      const [currentPage, setCurrentPage] = useState('list');
      const [newWord, setNewWord] = useState({
        english: '',
        korean: '',
        vietnamese: '',
        pronunciation: '',
        vietnamesePronunciation: '',
        phonetic: '',
        example: '',
        difficulty: 'beginner',
        tags: []
      });
      const [isTranslating, setIsTranslating] = useState(false);
      const [translationMode, setTranslationMode] = useState('en-to-ko'); // 'en-to-ko', 'ko-to-en', 'en-to-vi', 'vi-to-en', 'ko-to-vi', 'vi-to-ko'
      const [includeExample, setIncludeExample] = useState(false); // 예문 포함 여부

      // 플래시카드
      const [currentCardIndex, setCurrentCardIndex] = useState(0);
      const [isFlipped, setIsFlipped] = useState(false);

      // 문제풀이
      const [testMode, setTestMode] = useState(null);
      const [testQuestions, setTestQuestions] = useState([]);
      const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
      const [userAnswer, setUserAnswer] = useState('');
      const [showAnswer, setShowAnswer] = useState(false);
      const [testResults, setTestResults] = useState([]);

      // AI 추천
      const [recommendations, setRecommendations] = useState([]);
      const [isLoadingRecommendations, setIsLoadingRecommendations] = useState(false);

      // 검색
      const [searchQuery, setSearchQuery] = useState('');

      // 태그 관리
      const defaultTags = ['비즈니스', '여행', '시험', '일상', '기타'];
      const [availableTags, setAvailableTags] = useState(defaultTags);
      const [selectedTagFilter, setSelectedTagFilter] = useState('전체');

      // 학습 기록 (일별 통계)
      const [studyHistory, setStudyHistory] = useState(loadStudyHistory);

      // 즐겨찾기 필터
      const [showFavoritesOnly, setShowFavoritesOnly] = useState(false);

      // LocalStorage 자동 저장
      useEffect(() => {
        try {
          localStorage.setItem('vocabWords', JSON.stringify(words));
        } catch (error) {
          console.error('저장 오류:', error);
        }
      }, [words]);

      // 학습 기록 자동 저장
      useEffect(() => {
        try {
          localStorage.setItem('studyHistory', JSON.stringify(studyHistory));
        } catch (error) {
          console.error('학습 기록 저장 오류:', error);
        }
      }, [studyHistory]);

      // 단어 추가
      const addWord = () => {
        if (!newWord.english || !newWord.korean) {
          alert('영단어와 뜻은 필수입니다!');
          return;
        }

        const word = {
          id: Date.now(),
          ...newWord,
          learnCount: 0,
          correctCount: 0,
          wrongCount: 0,
          isFavorite: false,
          lastReviewed: null,
          nextReview: new Date().toISOString(),
          easeFactor: 2.5,
          interval: 1
        };

        setWords([...words, word]);
        setNewWord({
          english: '',
          korean: '',
          vietnamese: '',
          pronunciation: '',
          vietnamesePronunciation: '',
          phonetic: '',
          example: '',
          difficulty: 'beginner',
          tags: []
        });
        setCurrentPage('list');
      };

      // 번역 (다국어 지원) - Gemini API 사용
      const translateWord = async () => {
        const modeConfig = {
          'en-to-ko': { input: newWord.english, inputLang: '영어', outputLang: '한국어' },
          'ko-to-en': { input: newWord.korean, inputLang: '한국어', outputLang: '영어' },
          'en-to-vi': { input: newWord.english, inputLang: '영어', outputLang: '베트남어' },
          'vi-to-en': { input: newWord.vietnamese, inputLang: '베트남어', outputLang: '영어' },
          'ko-to-vi': { input: newWord.korean, inputLang: '한국어', outputLang: '베트남어' },
          'vi-to-ko': { input: newWord.vietnamese, inputLang: '베트남어', outputLang: '한국어' }
        };

        const config = modeConfig[translationMode];
        if (!config.input.trim()) {
          alert(`${config.inputLang}를 입력해주세요!`);
          return;
        }

        // 마지막 번역 모드 저장 (AI 추천에 활용)
        localStorage.setItem('lastTranslationMode', translationMode);

        setIsTranslating(true);
        try {
          const exampleInstruction = includeExample ? '"example": "간단한 영어 예문 1개",' : '';

          let prompt = '';
          if (translationMode === 'en-to-ko') {
            prompt = `영단어 "${newWord.english}"에 대해 다음 정보를 JSON 형식으로 제공해주세요:
{
  "korean": "한국어 뜻 (간단명료하게)",
  "pronunciation": "한글 발음",
  "phonetic": "IPA 발음기호",
  ${exampleInstruction}
}`;
          } else if (translationMode === 'ko-to-en') {
            prompt = `한국어 "${newWord.korean}"에 해당하는 영단어와 정보를 JSON 형식으로 제공해주세요:
{
  "english": "가장 적합한 영단어 1개",
  "pronunciation": "한글 발음",
  "phonetic": "IPA 발음기호",
  ${exampleInstruction}
}`;
          } else if (translationMode === 'en-to-vi') {
            prompt = `영단어 "${newWord.english}"에 대해 다음 정보를 JSON 형식으로 제공해주세요:
{
  "vietnamese": "베트남어 뜻",
  "vietnamesePronunciation": "베트남어 발음 (한글로)",
  "korean": "한국어 뜻 (참고용)",
  "phonetic": "IPA 발음기호",
  ${exampleInstruction}
}`;
          } else if (translationMode === 'vi-to-en') {
            prompt = `베트남어 "${newWord.vietnamese}"에 해당하는 영단어와 정보를 JSON 형식으로 제공해주세요:
{
  "english": "가장 적합한 영단어 1개",
  "korean": "한국어 뜻 (참고용)",
  "phonetic": "IPA 발음기호",
  ${exampleInstruction}
}`;
          } else if (translationMode === 'ko-to-vi') {
            prompt = `한국어 "${newWord.korean}"에 해당하는 베트남어와 정보를 JSON 형식으로 제공해주세요:
{
  "vietnamese": "베트남어 단어",
  "vietnamesePronunciation": "베트남어 발음 (한글로)",
  "english": "영어 단어 (참고용)",
  ${exampleInstruction}
}`;
          } else if (translationMode === 'vi-to-ko') {
            prompt = `베트남어 "${newWord.vietnamese}"에 대해 다음 정보를 JSON 형식으로 제공해주세요:
{
  "korean": "한국어 뜻",
  "vietnamese Pronunciation": "베트남어 발음 (한글로)",
  "english": "영어 단어 (참고용)",
  ${exampleInstruction}
}`;
          }

          prompt += '\n반드시 JSON만 출력하세요. 다른 설명 없이 JSON만 출력하세요.';

          const response = await fetch("/.netlify/functions/gemini", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              prompt: prompt
            })
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || `API 오류: ${response.status}`);
          }

          if (!data.text) {
            throw new Error('API 응답 형식 오류');
          }

          let responseText = data.text.trim();
          // JSON 추출 (마크다운 코드블록 제거)
          responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();

          const translation = JSON.parse(responseText);

          // 번역 결과 적용
          const updates = { ...newWord };
          if (translation.english) updates.english = translation.english;
          if (translation.korean) updates.korean = translation.korean;
          if (translation.vietnamese) updates.vietnamese = translation.vietnamese;
          if (translation.pronunciation) updates.pronunciation = translation.pronunciation;
          if (translation.vietnamesePronunciation) updates.vietnamesePronunciation = translation.vietnamesePronunciation;
          if (translation.phonetic) updates.phonetic = translation.phonetic;
          if (translation.example) updates.example = translation.example;

          setNewWord(updates);
        } catch (error) {
          console.error('번역 오류:', error);
          alert('번역 중 오류가 발생했습니다.');
        } finally {
          setIsTranslating(false);
        }
      };

      // 단어 복사
      const copyWord = (word) => {
        const text = word.english;

        navigator.clipboard.writeText(text).then(() => {
          alert('📋 복사되었습니다!');
        }).catch(() => {
          // 클립보드 실패 시 fallback
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          alert('📋 복사되었습니다!');
        });
      };

      // 단어 삭제
      const deleteWord = (id) => {
        if (confirm('정말 삭제하시겠습니까?')) {
          setWords(words.filter(w => w.id !== id));
        }
      };

      // 즐겨찾기 토글
      const toggleFavorite = (id) => {
        setWords(words.map(w =>
          w.id === id ? {...w, isFavorite: !w.isFavorite} : w
        ));
      };

      // 학습 기록 저장
      const recordStudy = (count, correct) => {
        const today = new Date().toISOString().split('T')[0];
        setStudyHistory(prev => ({
          ...prev,
          [today]: {
            count: (prev[today]?.count || 0) + count,
            correct: (prev[today]?.correct || 0) + correct,
            accuracy: Math.round(((prev[today]?.correct || 0) + correct) / ((prev[today]?.count || 0) + count) * 100)
          }
        }));
      };

      // Spaced Repetition
      const updateSpacedRepetition = (wordId, quality) => {
        setWords(words.map(w => {
          if (w.id !== wordId) return w;

          let newEaseFactor = w.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
          if (newEaseFactor < 1.3) newEaseFactor = 1.3;

          let newInterval;
          if (quality < 3) {
            newInterval = 1;
          } else {
            if (w.interval === 1) {
              newInterval = 6;
            } else {
              newInterval = Math.round(w.interval * newEaseFactor);
            }
          }

          const nextReview = new Date();
          nextReview.setDate(nextReview.getDate() + newInterval);

          return {
            ...w,
            easeFactor: newEaseFactor,
            interval: newInterval,
            nextReview: nextReview.toISOString(),
            lastReviewed: new Date().toISOString()
          };
        }));
      };

      const getDueWords = () => {
        const now = new Date();
        return words.filter(w => new Date(w.nextReview) <= now);
      };

      // 플래시카드
      const flipCard = () => setIsFlipped(!isFlipped);

      const markCardQuality = (quality) => {
        const currentWord = words[currentCardIndex];
        updateSpacedRepetition(currentWord.id, quality);
        nextCard();
      };

      const nextCard = () => {
        setIsFlipped(false);
        setCurrentCardIndex((prev) => (prev + 1) % words.length);
      };

      const prevCard = () => {
        setIsFlipped(false);
        setCurrentCardIndex((prev) => (prev - 1 + words.length) % words.length);
      };

      const startStudy = () => {
        if (words.length === 0) {
          alert('학습할 단어가 없습니다!');
          return;
        }
        setCurrentCardIndex(0);
        setIsFlipped(false);
        setCurrentPage('study');
      };

      // 문제풀이
      const startTest = (mode) => {
        if (words.length < 4) {
          alert('최소 4개의 단어가 필요합니다!');
          return;
        }

        setTestMode(mode);
        const shuffled = [...words].sort(() => Math.random() - 0.5);
        // 랜덤 퀴즈에서 호출되면 5문제, 아니면 10문제
        const questionCount = currentPage === 'randomQuiz' ? 5 : 10;
        const questions = shuffled.slice(0, Math.min(questionCount, words.length));
        
        if (mode === 'multiple') {
          const questionsWithOptions = questions.map(q => {
            const wrongAnswers = words
              .filter(w => w.id !== q.id)
              .sort(() => Math.random() - 0.5)
              .slice(0, 3)
              .map(w => w.korean);
            
            const options = [q.korean, ...wrongAnswers].sort(() => Math.random() - 0.5);
            return { ...q, options };
          });
          setTestQuestions(questionsWithOptions);
        } else {
          setTestQuestions(questions);
        }
        
        setCurrentQuestionIndex(0);
        setUserAnswer('');
        setShowAnswer(false);
        setTestResults([]);
        setCurrentPage('test');
      };

      const submitAnswer = () => {
        const currentQ = testQuestions[currentQuestionIndex];
        const isCorrect = testMode === 'multiple'
          ? userAnswer === currentQ.korean
          : userAnswer.toLowerCase().trim() === currentQ.english.toLowerCase().trim();

        setTestResults([...testResults, {
          word: currentQ,
          userAnswer,
          isCorrect
        }]);

        const quality = isCorrect ? 5 : 0;
        updateSpacedRepetition(currentQ.id, quality);

        setWords(words.map(w => {
          if (w.id === currentQ.id) {
            return {
              ...w,
              learnCount: w.learnCount + 1,
              correctCount: w.correctCount + (isCorrect ? 1 : 0),
              wrongCount: (w.wrongCount || 0) + (isCorrect ? 0 : 1)
            };
          }
          return w;
        }));

        // 학습 기록 저장
        recordStudy(1, isCorrect ? 1 : 0);

        setShowAnswer(true);
      };

      const nextQuestion = () => {
        if (currentQuestionIndex < testQuestions.length - 1) {
          setCurrentQuestionIndex(currentQuestionIndex + 1);
          setUserAnswer('');
          setShowAnswer(false);
        } else {
          setCurrentPage('testResult');
        }
      };

      // 통계
      const getStats = () => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const todayWords = words.filter(w => {
          if (!w.lastReviewed) return false;
          const reviewDate = new Date(w.lastReviewed);
          reviewDate.setHours(0, 0, 0, 0);
          return reviewDate.getTime() === today.getTime();
        });

        const totalLearnCount = words.reduce((sum, w) => sum + w.learnCount, 0);
        const totalCorrect = words.reduce((sum, w) => sum + w.correctCount, 0);
        const accuracy = totalLearnCount > 0 ? Math.round((totalCorrect / totalLearnCount) * 100) : 0;

        const byDifficulty = {
          beginner: words.filter(w => w.difficulty === 'beginner').length,
          intermediate: words.filter(w => w.difficulty === 'intermediate').length,
          advanced: words.filter(w => w.difficulty === 'advanced').length
        };

        return {
          todayCount: todayWords.length,
          totalWords: words.length,
          accuracy,
          dueWords: getDueWords().length,
          byDifficulty
        };
      };

      // AI 무제한 추천 (실시간 생성) - Gemini 사용, 3개로 축소
      const getRecommendations = async (category = 'auto') => {
        setIsLoadingRecommendations(true);
        try {
          const stats = getStats();
          const weakDifficulties = [];

          Object.entries(stats.byDifficulty).forEach(([diff, count]) => {
            if (count < 10) weakDifficulties.push(diff);
          });

          // 이미 등록된 단어 목록
          const registeredWords = words.map(w => w.english.toLowerCase());

          // 오답 단어 분석 (wrongCount > 0인 단어들)
          const wrongWords = words.filter(w => w.wrongCount > 0)
            .sort((a, b) => b.wrongCount - a.wrongCount)
            .slice(0, 10)
            .map(w => `${w.english}(틀린횟수:${w.wrongCount})`);

          // 최근 학습 언어 패턴 분석
          const recentTranslationMode = localStorage.getItem('lastTranslationMode') || 'en-to-ko';
          const languagePreference = recentTranslationMode.includes('vi') ? '베트남어 포함' : '한국어-영어';

          // 카테고리별 프롬프트
          const categoryPrompts = {
            'auto': `사용자의 학습 패턴을 분석하여 맞춤형 추천`,
            'toeic': `TOEIC 시험에 자주 출제되는 필수 단어`,
            'business': `비즈니스 실무에서 자주 사용하는 실용 단어`,
            'daily': `일상 생활에서 매일 사용하는 기본 단어`,
            'travel': `여행 시 필수적으로 알아야 할 단어`,
            'academic': `학술/대학 수준의 고급 어휘`
          };

          // 등록된 단어 목록을 안전하게 처리
          const wordList = registeredWords.slice(0, 100).join(', ').replace(/"/g, '\\"');
          const wordCount = registeredWords.length > 100 ? `외 ${registeredWords.length - 100}개 더 있음` : '';

          const prompt = `영단어 학습 앱 사용자에게 맞춤형 단어를 추천해주세요.

현재 통계:
- 총 단어 수: ${stats.totalWords}개
- 전체 정답률: ${stats.accuracy}%
- 오늘 학습: ${stats.todayCount}개
- 난이도별: 초급 ${stats.byDifficulty.beginner}개, 중급 ${stats.byDifficulty.intermediate}개, 고급 ${stats.byDifficulty.advanced}개
- 부족한 난이도: ${weakDifficulties.join(', ') || '균형 잡힘'}
- 선호 언어: ${languagePreference}
- 카테고리: ${categoryPrompts[category]}

이미 등록된 단어 (중복 제외): ${wordList} ${wordCount}

위 정보를 바탕으로 완전히 새로운 영단어 5개를 추천하고, 다음 JSON 형식으로만 응답하세요:

{
  "recommendations": [
    {
      "english": "단어",
      "korean": "한글 뜻",
      "vietnamese": "베트남어 뜻",
      "pronunciation": "한글 발음",
      "vietnamesePronunciation": "베트남어 발음",
      "phonetic": "IPA 기호",
      "difficulty": "beginner or intermediate or advanced",
      "tags": ["태그1", "태그2"],
      "example": "영어 예문"
    }
  ],
  "reason": "추천 이유"
}

태그 옵션: 비즈니스, 여행, 시험, 일상, 기술, 학술, 기타
중요: 순수 JSON만 출력하세요. 마크다운 코드블록 없이.`;

          const response = await fetch("/.netlify/functions/gemini", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              prompt: prompt
            })
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || `API 오류: ${response.status}`);
          }

          if (!data.text) {
            throw new Error('API 응답 형식 오류');
          }

          let responseText = data.text.trim();
          // JSON 추출 (마크다운 코드블록 제거)
          responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();

          const result = JSON.parse(responseText);
          
          // 중복 체크 (안전장치)
          const uniqueRecommendations = result.recommendations.filter(word => 
            !registeredWords.includes(word.english.toLowerCase())
          );

          setRecommendations({
            words: uniqueRecommendations,
            reason: result.reason
          });
        } catch (error) {
          console.error('AI 추천 오류:', error);
          alert('AI 추천 중 오류가 발생했습니다.\n오류: ' + (error.message || error));
          setRecommendations([]);
        } finally {
          setIsLoadingRecommendations(false);
        }
      };

      const addRecommendedWord = (word) => {
        const newWord = {
          id: Date.now(),
          ...word,
          learnCount: 0,
          correctCount: 0,
          lastReviewed: null,
          nextReview: new Date().toISOString(),
          easeFactor: 2.5,
          interval: 1
        };

        setWords([...words, newWord]);
        setRecommendations({
          ...recommendations,
          words: recommendations.words.filter(w => w.english !== word.english)
        });
      };

      // JSON 다운로드
      const downloadData = () => {
        const data = {
          words,
          exportDate: new Date().toISOString(),
          version: '1.0'
        };
        
        const jsonString = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `vocabulary_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      // JSON 업로드
      const uploadData = (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            if (data.words && Array.isArray(data.words)) {
              setWords(data.words);
              alert(`${data.words.length}개의 단어를 불러왔습니다!`);
            } else {
              alert('올바르지 않은 파일 형식입니다.');
            }
          } catch (error) {
            alert('파일을 읽는 중 오류가 발생했습니다.');
          }
        };
        reader.readAsText(file);
      };

      // 유틸리티
      const getDifficultyColor = (difficulty) => {
        const colors = {
          beginner: 'bg-green-100 text-green-800',
          intermediate: 'bg-yellow-100 text-yellow-800',
          advanced: 'bg-red-100 text-red-800'
        };
        return colors[difficulty] || colors.beginner;
      };

      const getDifficultyText = (difficulty) => {
        const text = {
          beginner: '초급',
          intermediate: '중급',
          advanced: '고급'
        };
        return text[difficulty] || '초급';
      };

      const NavButton = ({ page, label, icon }) => (
        <button
          onClick={() => setCurrentPage(page)}
          className={`flex items-center gap-2 px-4 py-2 rounded-lg transition ${
            currentPage === page ? 'bg-blue-500 text-white' : 'bg-gray-100 hover:bg-gray-200'
          }`}
        >
          {icon} {label}
        </button>
      );

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6">
          <div className="max-w-6xl mx-auto">
            {/* 헤더 */}
            <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
              <div className="flex items-center justify-between mb-6">
                <div className="flex items-center gap-3">
                  <span className="text-4xl">🎓</span>
                  <div>
                    <h1 className="text-3xl font-bold text-gray-800">AI 단어 암기장</h1>
                    <p className="text-sm text-green-600 font-semibold">💾 자동 저장 | 🤖 무제한 AI 생성</p>
                  </div>
                </div>
                <div className="flex items-center gap-4">
                  <div className="flex gap-2">
                    <button
                      onClick={downloadData}
                      className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition text-sm"
                      title="백업"
                    >
                      💾 백업
                    </button>
                    <label className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition cursor-pointer text-sm">
                      📤 복원
                      <input type="file" accept=".json" onChange={uploadData} className="hidden" />
                    </label>
                  </div>
                  <div className="text-right">
                    <p className="text-sm text-gray-600">단어</p>
                    <p className="text-2xl font-bold text-blue-500">{words.length}개</p>
                  </div>
                </div>
              </div>

              {/* 네비게이션 */}
              <div className="flex gap-3 flex-wrap">
                <NavButton page="list" icon="📚" label="목록" />
                <NavButton page="add" icon="➕" label="추가" />
                <button
                  onClick={startStudy}
                  className="flex items-center gap-2 px-4 py-2 rounded-lg transition bg-purple-500 text-white hover:bg-purple-600"
                >
                  📖 학습
                </button>
                <NavButton page="testMenu" icon="✍️" label="문제" />
                <NavButton page="wrongNote" icon="📝" label="오답노트" />
                <NavButton page="randomQuiz" icon="🎲" label="랜덤퀴즈" />
                <NavButton page="stats" icon="📊" label="통계" />
                <button
                  onClick={() => {
                    setCurrentPage('recommend');
                    if (recommendations.length === 0) getRecommendations();
                  }}
                  className="flex items-center gap-2 px-4 py-2 rounded-lg transition bg-gradient-to-r from-pink-500 to-purple-500 text-white hover:from-pink-600 hover:to-purple-600"
                >
                  🤖 AI 추천
                </button>
              </div>
            </div>

            {/* 메인 컨텐츠 */}
            <div className="bg-white rounded-2xl shadow-lg p-6">
              {/* 단어 목록 */}
              {currentPage === 'list' && (
                <div>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-2xl font-bold">📚 단어 목록</h2>
                    {words.length > 0 && (
                      <input
                        type="text"
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        placeholder="🔍 영어 또는 한글로 검색..."
                        className="px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none w-80"
                      />
                    )}
                  </div>

                  {/* 태그 필터 */}
                  {words.length > 0 && (
                    <div className="mb-4 space-y-2">
                      <div className="flex items-center gap-2 flex-wrap">
                        <span className="text-sm font-semibold text-gray-700">🏷️ 태그:</span>
                        <button
                          onClick={() => setSelectedTagFilter('전체')}
                          className={`px-3 py-1 rounded-lg text-sm font-semibold transition ${
                            selectedTagFilter === '전체'
                              ? 'bg-blue-500 text-white'
                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                          }`}
                        >
                          전체
                        </button>
                        {availableTags.map(tag => (
                          <button
                            key={tag}
                            onClick={() => setSelectedTagFilter(tag)}
                            className={`px-3 py-1 rounded-lg text-sm font-semibold transition ${
                              selectedTagFilter === tag
                                ? 'bg-blue-500 text-white'
                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                            }`}
                          >
                            {tag}
                          </button>
                        ))}
                        <button
                          onClick={() => setShowFavoritesOnly(!showFavoritesOnly)}
                          className={`px-3 py-1 rounded-lg text-sm font-semibold transition ml-auto ${
                            showFavoritesOnly
                              ? 'bg-yellow-500 text-white'
                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                          }`}
                        >
                          ⭐ 즐겨찾기만
                        </button>
                      </div>
                    </div>
                  )}

                  {words.length === 0 ? (
                    <div className="text-center py-12 text-gray-400">
                      <p className="text-6xl mb-4">📖</p>
                      <p>등록된 단어가 없습니다.</p>
                      <p className="text-sm">단어를 추가하거나 AI 추천을 받아보세요!</p>
                    </div>
                  ) : (
                    <div className="space-y-4">
                      {words
                        .filter(word => {
                          // 검색 필터
                          if (searchQuery.trim()) {
                            const query = searchQuery.toLowerCase();
                            const matchesSearch = word.english.toLowerCase().includes(query) ||
                                                 word.korean.toLowerCase().includes(query) ||
                                                 (word.vietnamese && word.vietnamese.toLowerCase().includes(query));
                            if (!matchesSearch) return false;
                          }

                          // 태그 필터
                          if (selectedTagFilter !== '전체') {
                            const wordTags = word.tags || [];
                            if (!wordTags.includes(selectedTagFilter)) return false;
                          }

                          // 즐겨찾기 필터
                          if (showFavoritesOnly && !word.isFavorite) return false;

                          return true;
                        })
                        .map(word => (
                        <div key={word.id} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                          <div className="flex justify-between items-start">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-2 flex-wrap">
                                <h3 className="text-xl font-bold">{word.english}</h3>
                                <span className={`px-3 py-1 rounded-full text-xs font-semibold ${getDifficultyColor(word.difficulty)}`}>
                                  {getDifficultyText(word.difficulty)}
                                </span>
                                {word.tags && word.tags.length > 0 && word.tags.map(tag => (
                                  <span key={tag} className="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-semibold">
                                    🏷️ {tag}
                                  </span>
                                ))}
                              </div>
                              <p className="text-lg mb-1">🇰🇷 {word.korean}</p>
                              {word.vietnamese && <p className="text-lg mb-1">🇻🇳 {word.vietnamese}</p>}
                              {word.pronunciation && <p className="text-sm text-gray-500 mb-1">🔊 {word.pronunciation}{word.phonetic && <span className="ml-2 text-blue-600">{word.phonetic}</span>}</p>}
                              {word.vietnamesePronunciation && <p className="text-sm text-gray-500 mb-1">🇻🇳🔊 {word.vietnamesePronunciation}</p>}
                              {word.example && <p className="text-sm text-gray-600 italic bg-gray-50 p-2 rounded">💬 {word.example}</p>}
                            </div>
                            <div className="flex gap-2">
                              <button
                                onClick={() => toggleFavorite(word.id)}
                                className={`p-2 rounded-lg transition ${word.isFavorite ? 'text-yellow-500 hover:bg-yellow-50' : 'text-gray-400 hover:bg-gray-50'}`}
                                title="즐겨찾기"
                              >
                                {word.isFavorite ? '⭐' : '☆'}
                              </button>
                              <button
                                onClick={() => copyWord(word)}
                                className="text-blue-500 hover:bg-blue-50 p-2 rounded-lg transition"
                                title="복사"
                              >
                                📋
                              </button>
                              <button
                                onClick={() => deleteWord(word.id)}
                                className="text-red-500 hover:bg-red-50 p-2 rounded-lg transition"
                                title="삭제"
                              >
                                🗑️
                              </button>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}

              {/* 단어 추가 */}
              {currentPage === 'add' && (
                <div>
                  <h2 className="text-2xl font-bold mb-4">➕ 단어 추가</h2>
                  
                  {/* 번역 모드 선택 */}
                  <div className="mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border-2 border-blue-200">
                    <p className="text-sm font-semibold mb-3 text-gray-700">🔄 번역 방향 선택</p>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-2 mb-4">
                      <button
                        onClick={() => setTranslationMode('en-to-ko')}
                        className={`py-2 px-3 rounded-lg font-semibold transition text-sm ${
                          translationMode === 'en-to-ko'
                            ? 'bg-blue-500 text-white'
                            : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        🇬🇧 영어 → 한글
                      </button>
                      <button
                        onClick={() => setTranslationMode('ko-to-en')}
                        className={`py-2 px-3 rounded-lg font-semibold transition text-sm ${
                          translationMode === 'ko-to-en'
                            ? 'bg-blue-500 text-white'
                            : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        🇰🇷 한글 → 영어
                      </button>
                      <button
                        onClick={() => setTranslationMode('en-to-vi')}
                        className={`py-2 px-3 rounded-lg font-semibold transition text-sm ${
                          translationMode === 'en-to-vi'
                            ? 'bg-blue-500 text-white'
                            : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        🇬🇧 영어 → 베트남어
                      </button>
                      <button
                        onClick={() => setTranslationMode('vi-to-en')}
                        className={`py-2 px-3 rounded-lg font-semibold transition text-sm ${
                          translationMode === 'vi-to-en'
                            ? 'bg-blue-500 text-white'
                            : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        🇻🇳 베트남어 → 영어
                      </button>
                      <button
                        onClick={() => setTranslationMode('ko-to-vi')}
                        className={`py-2 px-3 rounded-lg font-semibold transition text-sm ${
                          translationMode === 'ko-to-vi'
                            ? 'bg-blue-500 text-white'
                            : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        🇰🇷 한글 → 베트남어
                      </button>
                      <button
                        onClick={() => setTranslationMode('vi-to-ko')}
                        className={`py-2 px-3 rounded-lg font-semibold transition text-sm ${
                          translationMode === 'vi-to-ko'
                            ? 'bg-blue-500 text-white'
                            : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        🇻🇳 베트남어 → 한글
                      </button>
                    </div>

                    {/* 예문 포함 옵션 */}
                    <label className="flex items-center gap-2 cursor-pointer bg-white p-3 rounded-lg hover:bg-gray-50 transition">
                      <input
                        type="checkbox"
                        checked={includeExample}
                        onChange={(e) => setIncludeExample(e.target.checked)}
                        className="w-5 h-5"
                      />
                      <span className="text-sm font-semibold text-gray-700">
                        📝 예문 포함 (API 비용 증가)
                      </span>
                    </label>
                  </div>

                  <div className="space-y-4">
                    {/* 번역 입력 필드 */}
                    {(() => {
                      const modeFields = {
                        'en-to-ko': [
                          { label: '영단어 *', field: 'english', placeholder: '예: hello', withButton: true },
                          { label: '한국어 뜻 *', field: 'korean', placeholder: '자동 번역됩니다' }
                        ],
                        'ko-to-en': [
                          { label: '한국어 뜻 *', field: 'korean', placeholder: '예: 안녕', withButton: true },
                          { label: '영단어 *', field: 'english', placeholder: '자동 번역됩니다' }
                        ],
                        'en-to-vi': [
                          { label: '영단어 *', field: 'english', placeholder: '예: hello', withButton: true },
                          { label: '베트남어 *', field: 'vietnamese', placeholder: '자동 번역됩니다' }
                        ],
                        'vi-to-en': [
                          { label: '베트남어 *', field: 'vietnamese', placeholder: '예: xin chào', withButton: true },
                          { label: '영단어 *', field: 'english', placeholder: '자동 번역됩니다' }
                        ],
                        'ko-to-vi': [
                          { label: '한국어 뜻 *', field: 'korean', placeholder: '예: 안녕', withButton: true },
                          { label: '베트남어 *', field: 'vietnamese', placeholder: '자동 번역됩니다' }
                        ],
                        'vi-to-ko': [
                          { label: '베트남어 *', field: 'vietnamese', placeholder: '예: xin chào', withButton: true },
                          { label: '한국어 뜻 *', field: 'korean', placeholder: '자동 번역됩니다' }
                        ]
                      };

                      return modeFields[translationMode].map((fieldConfig, idx) => (
                        <div key={idx}>
                          <label className="block text-sm font-semibold mb-2">{fieldConfig.label}</label>
                          <div className={fieldConfig.withButton ? "flex gap-2" : ""}>
                            <input
                              type="text"
                              value={newWord[fieldConfig.field]}
                              onChange={(e) => setNewWord({...newWord, [fieldConfig.field]: e.target.value})}
                              onKeyPress={(e) => fieldConfig.withButton && e.key === 'Enter' && !isTranslating && newWord[fieldConfig.field].trim() && translateWord()}
                              className={`${fieldConfig.withButton ? 'flex-1' : 'w-full'} px-4 py-2 border rounded-lg`}
                              placeholder={fieldConfig.placeholder}
                            />
                            {fieldConfig.withButton && (
                              <button
                                onClick={translateWord}
                                disabled={isTranslating}
                                className="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition disabled:bg-gray-300"
                              >
                                {isTranslating ? '번역중...' : '🌐 번역'}
                              </button>
                            )}
                          </div>
                        </div>
                      ));
                    })()}

                    {/* 모든 언어 필드 (선택사항) */}
                    <div className="border-t pt-4">
                      <p className="text-sm font-semibold text-gray-600 mb-3">📝 추가 정보 (선택사항)</p>
                      <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                          <label className="block text-xs font-semibold mb-2 text-gray-600">🇬🇧 영어</label>
                          <input
                            type="text"
                            value={newWord.english}
                            onChange={(e) => setNewWord({...newWord, english: e.target.value})}
                            className="w-full px-3 py-2 border rounded text-sm"
                            placeholder="English"
                          />
                        </div>
                        <div>
                          <label className="block text-xs font-semibold mb-2 text-gray-600">🇰🇷 한국어</label>
                          <input
                            type="text"
                            value={newWord.korean}
                            onChange={(e) => setNewWord({...newWord, korean: e.target.value})}
                            className="w-full px-3 py-2 border rounded text-sm"
                            placeholder="한국어"
                          />
                        </div>
                        <div>
                          <label className="block text-xs font-semibold mb-2 text-gray-600">🇻🇳 베트남어</label>
                          <input
                            type="text"
                            value={newWord.vietnamese}
                            onChange={(e) => setNewWord({...newWord, vietnamese: e.target.value})}
                            className="w-full px-3 py-2 border rounded text-sm"
                            placeholder="Tiếng Việt"
                          />
                        </div>
                      </div>
                      <div className="grid grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs font-semibold mb-2 text-gray-600">한글 발음</label>
                          <input
                            type="text"
                            value={newWord.pronunciation}
                            onChange={(e) => setNewWord({...newWord, pronunciation: e.target.value})}
                            className="w-full px-3 py-2 border rounded text-sm"
                            placeholder="예: 헬로우"
                          />
                        </div>
                        <div>
                          <label className="block text-xs font-semibold mb-2 text-gray-600">베트남어 발음</label>
                          <input
                            type="text"
                            value={newWord.vietnamesePronunciation}
                            onChange={(e) => setNewWord({...newWord, vietnamesePronunciation: e.target.value})}
                            className="w-full px-3 py-2 border rounded text-sm"
                            placeholder="예: 신짜오"
                          />
                        </div>
                        <div>
                          <label className="block text-xs font-semibold mb-2 text-gray-600">발음기호 (IPA)</label>
                          <input
                            type="text"
                            value={newWord.phonetic}
                            onChange={(e) => setNewWord({...newWord, phonetic: e.target.value})}
                            className="w-full px-3 py-2 border rounded text-sm"
                            placeholder="/həˈloʊ/"
                          />
                        </div>
                      </div>
                    </div>
                    <div>
                      <label className="block text-sm font-semibold mb-2">예문</label>
                      <textarea
                        value={newWord.example}
                        onChange={(e) => setNewWord({...newWord, example: e.target.value})}
                        className="w-full px-4 py-2 border rounded-lg"
                        rows="3"
                        placeholder="예: The beauty of cherry blossoms is ephemeral."
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-semibold mb-2">난이도</label>
                      <select
                        value={newWord.difficulty}
                        onChange={(e) => setNewWord({...newWord, difficulty: e.target.value})}
                        className="w-full px-4 py-2 border rounded-lg"
                      >
                        <option value="beginner">초급</option>
                        <option value="intermediate">중급</option>
                        <option value="advanced">고급</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-semibold mb-2">🏷️ 태그 (복수 선택 가능)</label>
                      <div className="flex flex-wrap gap-2">
                        {availableTags.map(tag => (
                          <button
                            key={tag}
                            type="button"
                            onClick={() => {
                              const newTags = newWord.tags.includes(tag)
                                ? newWord.tags.filter(t => t !== tag)
                                : [...newWord.tags, tag];
                              setNewWord({...newWord, tags: newTags});
                            }}
                            className={`px-4 py-2 rounded-lg font-semibold transition ${
                              newWord.tags.includes(tag)
                                ? 'bg-blue-500 text-white'
                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                            }`}
                          >
                            {tag}
                          </button>
                        ))}
                      </div>
                    </div>
                    <div className="flex gap-3 pt-4">
                      <button
                        onClick={addWord}
                        className="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition font-semibold"
                      >
                        단어 추가
                      </button>
                      <button
                        onClick={() => setCurrentPage('list')}
                        className="px-6 bg-gray-200 py-3 rounded-lg hover:bg-gray-300 transition font-semibold"
                      >
                        취소
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* 학습 모드 */}
              {currentPage === 'study' && words.length > 0 && (
                <div>
                  <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold">📖 학습 모드</h2>
                    <div className="text-sm text-gray-600">
                      {currentCardIndex + 1} / {words.length}
                    </div>
                  </div>

                  <div className="max-w-2xl mx-auto">
                    <div 
                      onClick={flipCard}
                      className={`flip-card ${isFlipped ? 'flipped' : ''} cursor-pointer mb-8`}
                    >
                      <div className="flip-card-inner relative h-96">
                        <div className="flip-card-front absolute w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl shadow-2xl flex items-center justify-center p-8">
                          <div className="text-center text-white">
                            <p className="text-6xl font-bold mb-4">{words[currentCardIndex].english}</p>
                            <span className={`px-4 py-2 rounded-full text-sm font-semibold ${getDifficultyColor(words[currentCardIndex].difficulty)}`}>
                              {getDifficultyText(words[currentCardIndex].difficulty)}
                            </span>
                            <p className="mt-8 text-white/70">카드를 클릭하여 뜻 보기</p>
                          </div>
                        </div>

                        <div className="flip-card-back absolute w-full h-full bg-gradient-to-br from-green-500 to-teal-600 rounded-2xl shadow-2xl p-8">
                          <div className="text-white h-full flex flex-col justify-center">
                            <h3 className="text-4xl font-bold mb-4 text-center">{words[currentCardIndex].english}</h3>
                            <div className="space-y-4 bg-white/10 rounded-xl p-6 backdrop-blur">
                              <div>
                                <p className="text-sm opacity-80">한국어 뜻</p>
                                <p className="text-2xl font-semibold">{words[currentCardIndex].korean}</p>
                              </div>
                              {words[currentCardIndex].pronunciation && (
                                <div>
                                  <p className="text-sm opacity-80">발음</p>
                                  <p className="text-xl">{words[currentCardIndex].pronunciation}</p>
                                </div>
                              )}
                              {words[currentCardIndex].example && (
                                <div>
                                  <p className="text-sm opacity-80">예문</p>
                                  <p className="text-lg italic">{words[currentCardIndex].example}</p>
                                </div>
                              )}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div className="flex justify-between items-center mb-4">
                      <button onClick={prevCard} className="px-6 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">← 이전</button>
                      <button onClick={flipCard} className="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold">카드 뒤집기</button>
                      <button onClick={nextCard} className="px-6 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">다음 →</button>
                    </div>

                    {isFlipped && (
                      <div className="p-4 bg-gray-50 rounded-xl mb-4">
                        <p className="text-sm text-gray-600 mb-3 text-center">얼마나 잘 기억하셨나요?</p>
                        <div className="grid grid-cols-3 gap-2">
                          <button onClick={() => markCardQuality(0)} className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm">❌ 모름</button>
                          <button onClick={() => markCardQuality(3)} className="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 text-sm">🤔 어려움</button>
                          <button onClick={() => markCardQuality(5)} className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm">✅ 완벽</button>
                        </div>
                      </div>
                    )}

                    <button onClick={() => setCurrentPage('list')} className="w-full px-6 py-3 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg font-semibold">학습 종료</button>
                  </div>
                </div>
              )}

              {/* 문제풀이 메뉴 */}
              {currentPage === 'testMenu' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">✍️ 문제풀이 모드</h2>
                  <div className="grid md:grid-cols-2 gap-6 max-w-3xl mx-auto">
                    <div onClick={() => startTest('multiple')} className="bg-gradient-to-br from-blue-50 to-blue-100 p-8 rounded-2xl border-2 border-blue-200 hover:border-blue-400 cursor-pointer transition hover:shadow-lg">
                      <div className="text-5xl mb-4">📝</div>
                      <h3 className="text-2xl font-bold mb-2">객관식</h3>
                      <p className="text-gray-600">4개의 보기 중 정답 선택</p>
                    </div>
                    <div onClick={() => startTest('written')} className="bg-gradient-to-br from-green-50 to-green-100 p-8 rounded-2xl border-2 border-green-200 hover:border-green-400 cursor-pointer transition hover:shadow-lg">
                      <div className="text-5xl mb-4">✏️</div>
                      <h3 className="text-2xl font-bold mb-2">주관식</h3>
                      <p className="text-gray-600">뜻을 보고 영단어 입력</p>
                    </div>
                  </div>
                </div>
              )}

              {/* 문제풀이 */}
              {currentPage === 'test' && testQuestions.length > 0 && (
                <div>
                  <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold">{testMode === 'multiple' ? '📝 객관식' : '✏️ 주관식'}</h2>
                    <div className="text-sm text-gray-600">{currentQuestionIndex + 1} / {testQuestions.length}</div>
                  </div>

                  <div className="max-w-2xl mx-auto">
                    <div className="bg-gradient-to-br from-purple-50 to-pink-50 p-8 rounded-2xl border-2 border-purple-200 mb-6">
                      {testMode === 'multiple' ? (
                        <>
                          <p className="text-gray-600 mb-4">다음 단어의 뜻은?</p>
                          <h3 className="text-4xl font-bold mb-6">{testQuestions[currentQuestionIndex].english}</h3>
                          <div className="space-y-3">
                            {testQuestions[currentQuestionIndex].options.map((option, idx) => (
                              <button
                                key={idx}
                                onClick={() => !showAnswer && setUserAnswer(option)}
                                disabled={showAnswer}
                                className={`w-full p-4 rounded-lg text-left transition ${
                                  showAnswer
                                    ? option === testQuestions[currentQuestionIndex].korean
                                      ? 'bg-green-500 text-white'
                                      : userAnswer === option ? 'bg-red-500 text-white' : 'bg-gray-100'
                                    : userAnswer === option ? 'bg-blue-500 text-white' : 'bg-white hover:bg-gray-50 border-2 border-gray-200'
                                }`}
                              >
                                {option}
                              </button>
                            ))}
                          </div>
                        </>
                      ) : (
                        <>
                          <p className="text-gray-600 mb-4">다음 뜻에 해당하는 영단어는?</p>
                          <h3 className="text-3xl font-bold mb-6">{testQuestions[currentQuestionIndex].korean}</h3>
                          {testQuestions[currentQuestionIndex].pronunciation && (
                            <p className="text-gray-600 mb-4">발음: {testQuestions[currentQuestionIndex].pronunciation}</p>
                          )}
                          <input
                            type="text"
                            value={userAnswer}
                            onChange={(e) => setUserAnswer(e.target.value)}
                            disabled={showAnswer}
                            className="w-full p-4 text-2xl border-2 rounded-lg"
                            placeholder="영단어를 입력하세요"
                            onKeyPress={(e) => e.key === 'Enter' && !showAnswer && userAnswer && submitAnswer()}
                          />
                        </>
                      )}
                    </div>

                    {showAnswer && (
                      <div className={`p-6 rounded-xl mb-6 ${testResults[testResults.length - 1].isCorrect ? 'bg-green-100 border-2 border-green-500' : 'bg-red-100 border-2 border-red-500'}`}>
                        <p className="text-2xl font-bold mb-2">{testResults[testResults.length - 1].isCorrect ? '✅ 정답!' : '❌ 오답'}</p>
                        <p className="text-lg">정답: <strong>{testQuestions[currentQuestionIndex][testMode === 'multiple' ? 'korean' : 'english']}</strong></p>
                      </div>
                    )}

                    <div className="flex gap-3">
                      {!showAnswer ? (
                        <button onClick={submitAnswer} disabled={!userAnswer} className="flex-1 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 font-semibold disabled:bg-gray-300">제출</button>
                      ) : (
                        <button onClick={nextQuestion} className="flex-1 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold">
                          {currentQuestionIndex < testQuestions.length - 1 ? '다음 문제' : '결과 보기'}
                        </button>
                      )}
                      <button onClick={() => setCurrentPage('testMenu')} className="px-6 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">종료</button>
                    </div>
                  </div>
                </div>
              )}

              {/* 테스트 결과 */}
              {currentPage === 'testResult' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6 text-center">📊 테스트 결과</h2>
                  <div className="max-w-2xl mx-auto">
                    <div className="bg-gradient-to-br from-blue-500 to-purple-600 text-white p-8 rounded-2xl mb-6 text-center">
                      <p className="text-xl mb-2">총 {testResults.length}문제</p>
                      <p className="text-5xl font-bold mb-2">{testResults.filter(r => r.isCorrect).length} / {testResults.length}</p>
                      <p className="text-2xl">정답률: {Math.round((testResults.filter(r => r.isCorrect).length / testResults.length) * 100)}%</p>
                    </div>

                    <div className="space-y-3 mb-6">
                      {testResults.map((result, idx) => (
                        <div key={idx} className={`p-4 rounded-lg border-2 ${result.isCorrect ? 'bg-green-50 border-green-300' : 'bg-red-50 border-red-300'}`}>
                          <p className="font-bold text-lg">{result.isCorrect ? '✅' : '❌'} {result.word.english}</p>
                          <p className="text-gray-600">정답: {testMode === 'multiple' ? result.word.korean : result.word.english}</p>
                          {!result.isCorrect && <p className="text-red-600 text-sm">입력: {result.userAnswer}</p>}
                        </div>
                      ))}
                    </div>

                    <div className="flex gap-3">
                      <button onClick={() => startTest(testMode)} className="flex-1 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold">다시 풀기</button>
                      <button onClick={() => setCurrentPage('testMenu')} className="flex-1 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">메뉴로</button>
                    </div>
                  </div>
                </div>
              )}

              {/* 통계 */}
              {currentPage === 'stats' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">📊 학습 통계</h2>
                  {(() => {
                    const stats = getStats();
                    return (
                      <div className="max-w-4xl mx-auto space-y-6">
                        <div className="grid md:grid-cols-4 gap-4">
                          <div className="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">오늘 학습</p>
                            <p className="text-4xl font-bold">{stats.todayCount}</p>
                            <p className="text-sm opacity-80">단어</p>
                          </div>
                          <div className="bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">전체 정답률</p>
                            <p className="text-4xl font-bold">{stats.accuracy}%</p>
                          </div>
                          <div className="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">총 단어</p>
                            <p className="text-4xl font-bold">{stats.totalWords}</p>
                          </div>
                          <div className="bg-gradient-to-br from-orange-500 to-orange-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">복습 필요</p>
                            <p className="text-4xl font-bold">{stats.dueWords}</p>
                          </div>
                        </div>

                        <div className="bg-white p-6 rounded-xl border-2">
                          <h3 className="text-xl font-bold mb-4">📈 난이도별 분포</h3>
                          <div className="space-y-3">
                            {Object.entries(stats.byDifficulty).map(([diff, count]) => (
                              <div key={diff} className="flex items-center gap-3">
                                <div className="w-24 text-sm font-semibold">{getDifficultyText(diff)}</div>
                                <div className="flex-1 bg-gray-200 rounded-full h-8">
                                  <div 
                                    className={`h-8 rounded-full flex items-center justify-end pr-3 text-white font-semibold text-sm ${
                                      diff === 'beginner' ? 'bg-green-500' : diff === 'intermediate' ? 'bg-yellow-500' : 'bg-red-500'
                                    }`}
                                    style={{ width: `${stats.totalWords > 0 ? (count / stats.totalWords) * 100 : 0}%` }}
                                  >
                                    {count}개
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* 학습 그래프 */}
                        <div className="bg-white p-6 rounded-xl border-2">
                          <h3 className="text-xl font-bold mb-4">📈 최근 7일 학습 기록</h3>
                          {(() => {
                            const last7Days = [];
                            for (let i = 6; i >= 0; i--) {
                              const date = new Date();
                              date.setDate(date.getDate() - i);
                              const dateStr = date.toISOString().split('T')[0];
                              const dayData = studyHistory[dateStr] || { count: 0, accuracy: 0 };
                              last7Days.push({
                                date: dateStr,
                                day: ['일', '월', '화', '수', '목', '금', '토'][date.getDay()],
                                ...dayData
                              });
                            }
                            const maxCount = Math.max(...last7Days.map(d => d.count), 1);

                            return (
                              <div className="space-y-4">
                                <div className="flex items-end justify-between gap-2 h-48">
                                  {last7Days.map((day, idx) => (
                                    <div key={idx} className="flex-1 flex flex-col items-center gap-2">
                                      <div className="flex-1 flex flex-col justify-end w-full">
                                        {day.count > 0 && (
                                          <div className="relative group">
                                            <div
                                              className="bg-gradient-to-t from-blue-500 to-blue-400 rounded-t hover:from-blue-600 hover:to-blue-500 transition cursor-pointer"
                                              style={{ height: `${(day.count / maxCount) * 160}px`, minHeight: day.count > 0 ? '20px' : '0' }}
                                            >
                                              <div className="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap">
                                                {day.count}문제 ({day.accuracy}%)
                                              </div>
                                            </div>
                                          </div>
                                        )}
                                      </div>
                                      <div className="text-xs font-semibold text-gray-600">{day.day}</div>
                                      <div className="text-xs text-gray-400">{day.date.slice(5)}</div>
                                    </div>
                                  ))}
                                </div>
                                <div className="text-sm text-gray-600 text-center">
                                  총 {last7Days.reduce((sum, d) => sum + d.count, 0)}문제 학습
                                </div>
                              </div>
                            );
                          })()}
                        </div>

                        {getDueWords().length > 0 && (
                          <div className="bg-orange-50 p-6 rounded-xl border-2 border-orange-300">
                            <h3 className="text-xl font-bold mb-4">🔔 복습 필요 단어</h3>
                            <div className="space-y-2 max-h-64 overflow-y-auto">
                              {getDueWords().map(word => (
                                <div key={word.id} className="bg-white p-3 rounded-lg border">
                                  <span className="font-bold">{word.english}</span> - {word.korean}
                                </div>
                              ))}
                            </div>
                            <button onClick={startStudy} className="w-full mt-4 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-semibold">지금 복습하기</button>
                          </div>
                        )}
                      </div>
                    );
                  })()}
                </div>
              )}

              {/* AI 무제한 추천 */}
              {currentPage === 'recommend' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">🤖 AI 스마트 단어 추천</h2>
                  <div className="max-w-3xl mx-auto">
                    {recommendations.length === 0 ? (
                      <div className="text-center py-12">
                        <div className="text-6xl mb-4">🤖</div>
                        <h3 className="text-xl font-bold mb-4">
                          AI가 학습 패턴을 분석하여<br />
                          <span className="text-pink-600">맞춤형 단어</span>를 추천합니다
                        </h3>
                        <p className="text-gray-600 mb-6">
                          카테고리를 선택하거나 자동 추천을 받으세요!
                        </p>

                        {/* 카테고리 선택 버튼 */}
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-3 mb-8 max-w-2xl mx-auto">
                          <button
                            onClick={() => getRecommendations('auto')}
                            disabled={isLoadingRecommendations}
                            className="p-4 bg-gradient-to-br from-pink-500 to-purple-600 text-white rounded-xl hover:from-pink-600 hover:to-purple-700 font-semibold disabled:opacity-50 shadow-lg"
                          >
                            <div className="text-2xl mb-1">🎯</div>
                            <div className="text-sm">맞춤 추천</div>
                            <div className="text-xs opacity-80">학습 패턴 분석</div>
                          </button>
                          <button
                            onClick={() => getRecommendations('toeic')}
                            disabled={isLoadingRecommendations}
                            className="p-4 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 font-semibold disabled:opacity-50 shadow-lg"
                          >
                            <div className="text-2xl mb-1">📝</div>
                            <div className="text-sm">TOEIC</div>
                            <div className="text-xs opacity-80">시험 빈출 단어</div>
                          </button>
                          <button
                            onClick={() => getRecommendations('business')}
                            disabled={isLoadingRecommendations}
                            className="p-4 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 font-semibold disabled:opacity-50 shadow-lg"
                          >
                            <div className="text-2xl mb-1">💼</div>
                            <div className="text-sm">비즈니스</div>
                            <div className="text-xs opacity-80">실무 필수 단어</div>
                          </button>
                          <button
                            onClick={() => getRecommendations('daily')}
                            disabled={isLoadingRecommendations}
                            className="p-4 bg-gradient-to-br from-yellow-500 to-orange-500 text-white rounded-xl hover:from-yellow-600 hover:to-orange-600 font-semibold disabled:opacity-50 shadow-lg"
                          >
                            <div className="text-2xl mb-1">🏠</div>
                            <div className="text-sm">일상생활</div>
                            <div className="text-xs opacity-80">기본 필수 단어</div>
                          </button>
                          <button
                            onClick={() => getRecommendations('travel')}
                            disabled={isLoadingRecommendations}
                            className="p-4 bg-gradient-to-br from-cyan-500 to-blue-500 text-white rounded-xl hover:from-cyan-600 hover:to-blue-600 font-semibold disabled:opacity-50 shadow-lg"
                          >
                            <div className="text-2xl mb-1">✈️</div>
                            <div className="text-sm">여행</div>
                            <div className="text-xs opacity-80">여행 필수 단어</div>
                          </button>
                          <button
                            onClick={() => getRecommendations('academic')}
                            disabled={isLoadingRecommendations}
                            className="p-4 bg-gradient-to-br from-purple-500 to-indigo-600 text-white rounded-xl hover:from-purple-600 hover:to-indigo-700 font-semibold disabled:opacity-50 shadow-lg"
                          >
                            <div className="text-2xl mb-1">🎓</div>
                            <div className="text-sm">학술</div>
                            <div className="text-xs opacity-80">고급 어휘</div>
                          </button>
                        </div>

                        {isLoadingRecommendations && (
                          <div className="text-center text-gray-600">
                            <div className="text-4xl mb-2">🔄</div>
                            <p>AI가 맞춤형 단어를 분석 중입니다...</p>
                          </div>
                        )}
                      </div>
                    ) : (
                      <div>
                        <div className="bg-gradient-to-r from-pink-50 to-purple-50 p-6 rounded-xl border-2 border-purple-200 mb-6">
                          <p className="text-gray-700"><strong>💡 AI 추천 이유:</strong> {recommendations.reason}</p>
                        </div>

                        <div className="space-y-4 mb-6">
                          {recommendations.words && recommendations.words.map((word, idx) => (
                            <div key={idx} className="bg-white p-6 rounded-xl border-2 hover:border-purple-400 transition">
                              <div className="flex items-center gap-3 mb-2">
                                <h3 className="text-2xl font-bold">{word.english}</h3>
                                <span className={`px-3 py-1 rounded-full text-xs font-semibold ${getDifficultyColor(word.difficulty)}`}>
                                  {getDifficultyText(word.difficulty)}
                                </span>
                              </div>
                              <p className="text-lg mb-2">🇰🇷 {word.korean}</p>
                              {word.vietnamese && <p className="text-lg mb-2">🇻🇳 {word.vietnamese}</p>}
                              <p className="text-sm text-gray-500 mb-2">🔊 {word.pronunciation}{word.phonetic && <span className="ml-2 text-blue-600">{word.phonetic}</span>}</p>
                              {word.vietnamesePronunciation && <p className="text-sm text-gray-500 mb-2">🇻🇳🔊 {word.vietnamesePronunciation}</p>}
                              {word.example && <p className="text-sm text-gray-600 italic bg-gray-50 p-3 rounded mb-3">💬 {word.example}</p>}
                              {word.tags && word.tags.length > 0 && (
                                <div className="flex gap-2 mb-3">
                                  {word.tags.map(tag => (
                                    <span key={tag} className="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-semibold">
                                      🏷️ {tag}
                                    </span>
                                  ))}
                                </div>
                              )}
                              <button
                                onClick={() => addRecommendedWord(word)}
                                className="w-full py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 font-semibold"
                              >
                                ➕ 단어장에 추가
                              </button>
                            </div>
                          ))}
                        </div>

                        <div className="grid grid-cols-2 gap-3 mb-6">
                          <button
                            onClick={() => setRecommendations([])}
                            className="py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold"
                          >
                            ← 카테고리 선택
                          </button>
                          <button
                            onClick={() => getRecommendations('auto')}
                            disabled={isLoadingRecommendations}
                            className="py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 font-semibold disabled:opacity-50"
                          >
                            {isLoadingRecommendations ? '🔄 분석 중...' : '🔄 다시 추천 받기'}
                          </button>
                        </div>

                        <div className="p-4 bg-blue-50 rounded-lg border border-blue-200">
                          <p className="text-sm text-gray-700 text-center">
                            💡 <strong>맞춤형 추천:</strong> 학습 패턴, 오답 분석, 언어 선호도를 기반으로 5개 단어를 추천합니다!
                          </p>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* 오답노트 */}
              {currentPage === 'wrongNote' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">📝 오답노트</h2>
                  {(() => {
                    const wrongWords = words.filter(w => (w.wrongCount || 0) > 0).sort((a, b) => (b.wrongCount || 0) - (a.wrongCount || 0));

                    if (wrongWords.length === 0) {
                      return (
                        <div className="text-center py-12 text-gray-400">
                          <p className="text-6xl mb-4">✅</p>
                          <p className="text-lg">틀린 단어가 없습니다!</p>
                          <p className="text-sm">문제를 풀면 오답 단어가 여기에 표시됩니다.</p>
                        </div>
                      );
                    }

                    return (
                      <div>
                        <div className="bg-red-50 p-4 rounded-lg mb-6 border-2 border-red-200">
                          <p className="text-sm text-gray-700">
                            💡 <strong>오답 횟수가 많은 단어부터</strong> 표시됩니다. 집중 학습이 필요한 단어들입니다!
                          </p>
                        </div>

                        <div className="space-y-4">
                          {wrongWords.map(word => (
                            <div key={word.id} className="bg-white p-4 rounded-lg border-2 border-red-200 hover:shadow-md transition">
                              <div className="flex justify-between items-start">
                                <div className="flex-1">
                                  <div className="flex items-center gap-3 mb-2">
                                    <h3 className="text-xl font-bold">{word.english}</h3>
                                    <span className="px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold">
                                      ❌ {word.wrongCount}회 오답
                                    </span>
                                    <span className={`px-3 py-1 rounded-full text-xs font-semibold ${getDifficultyColor(word.difficulty)}`}>
                                      {getDifficultyText(word.difficulty)}
                                    </span>
                                  </div>
                                  <p className="text-lg mb-1">🇰🇷 {word.korean}</p>
                                  {word.pronunciation && <p className="text-sm text-gray-500 mb-1">🔊 {word.pronunciation}</p>}
                                  {word.example && <p className="text-sm text-gray-600 italic bg-gray-50 p-2 rounded">💬 {word.example}</p>}
                                  <p className="text-xs text-gray-500 mt-2">
                                    정답률: {word.learnCount > 0 ? Math.round((word.correctCount / word.learnCount) * 100) : 0}% ({word.correctCount}/{word.learnCount})
                                  </p>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>

                        <button
                          onClick={() => startTest('multiple')}
                          className="w-full mt-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 font-semibold"
                        >
                          🔥 오답 단어 집중 복습하기
                        </button>
                      </div>
                    );
                  })()}
                </div>
              )}

              {/* 랜덤 퀴즈 */}
              {currentPage === 'randomQuiz' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">🎲 랜덤 퀴즈</h2>
                  {words.length < 5 ? (
                    <div className="text-center py-12 text-gray-400">
                      <p className="text-6xl mb-4">📚</p>
                      <p className="text-lg">최소 5개의 단어가 필요합니다!</p>
                      <p className="text-sm">단어를 더 추가해주세요.</p>
                    </div>
                  ) : (
                    <div className="max-w-3xl mx-auto">
                      <div className="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border-2 border-purple-200 mb-6">
                        <h3 className="text-xl font-bold mb-2">⚡ 빠른 학습 모드</h3>
                        <p className="text-gray-700">
                          무작위로 선택된 5문제를 풀어보세요! 간단하고 빠르게 실력을 체크할 수 있습니다.
                        </p>
                      </div>

                      <div className="grid md:grid-cols-2 gap-4">
                        <button
                          onClick={() => startTest('multiple')}
                          className="bg-gradient-to-br from-blue-50 to-blue-100 p-8 rounded-2xl border-2 border-blue-200 hover:border-blue-400 transition hover:shadow-lg"
                        >
                          <div className="text-5xl mb-4">📝</div>
                          <h3 className="text-2xl font-bold mb-2">객관식 퀴즈</h3>
                          <p className="text-gray-600">5문제 객관식</p>
                        </button>
                        <button
                          onClick={() => startTest('written')}
                          className="bg-gradient-to-br from-green-50 to-green-100 p-8 rounded-2xl border-2 border-green-200 hover:border-green-400 transition hover:shadow-lg"
                        >
                          <div className="text-5xl mb-4">✏️</div>
                          <h3 className="text-2xl font-bold mb-2">주관식 퀴즈</h3>
                          <p className="text-gray-600">5문제 주관식</p>
                        </button>
                      </div>

                      <div className="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <p className="text-sm text-gray-700 text-center">
                          💡 <strong>Tip:</strong> 매일 퀴즈를 풀면 학습 그래프에 기록됩니다!
                        </p>
                      </div>
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<VocabApp />, document.getElementById('root'));
  </script>
</body>
</html>