<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI 단어 암기장 - 무제한 AI 생성</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .flip-card {
      perspective: 1000px;
    }
    .flip-card-inner {
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .flip-card.flipped .flip-card-inner {
      transform: rotateY(180deg);
    }
    .flip-card-front, .flip-card-back {
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }
    .flip-card-back {
      transform: rotateY(180deg);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function VocabApp() {
      // LocalStorage에서 불러오기
      const loadFromStorage = () => {
        try {
          const saved = localStorage.getItem('vocabWords');
          if (saved) {
            return JSON.parse(saved);
          }
        } catch (error) {
          console.error('데이터 로드 오류:', error);
        }
        return [];
      };

      const [words, setWords] = useState(loadFromStorage);
      const [currentPage, setCurrentPage] = useState('list');
      const [newWord, setNewWord] = useState({
        english: '',
        korean: '',
        pronunciation: '',
        example: '',
        difficulty: 'beginner'
      });
      const [isTranslating, setIsTranslating] = useState(false);
      const [translationMode, setTranslationMode] = useState('en-to-ko'); // 'en-to-ko' 또는 'ko-to-en'

      // 플래시카드
      const [currentCardIndex, setCurrentCardIndex] = useState(0);
      const [isFlipped, setIsFlipped] = useState(false);

      // 문제풀이
      const [testMode, setTestMode] = useState(null);
      const [testQuestions, setTestQuestions] = useState([]);
      const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
      const [userAnswer, setUserAnswer] = useState('');
      const [showAnswer, setShowAnswer] = useState(false);
      const [testResults, setTestResults] = useState([]);

      // AI 추천
      const [recommendations, setRecommendations] = useState([]);
      const [isLoadingRecommendations, setIsLoadingRecommendations] = useState(false);

      // LocalStorage 자동 저장
      useEffect(() => {
        try {
          localStorage.setItem('vocabWords', JSON.stringify(words));
        } catch (error) {
          console.error('저장 오류:', error);
        }
      }, [words]);

      // 단어 추가
      const addWord = () => {
        if (!newWord.english || !newWord.korean) {
          alert('영단어와 뜻은 필수입니다!');
          return;
        }

        const word = {
          id: Date.now(),
          ...newWord,
          learnCount: 0,
          correctCount: 0,
          lastReviewed: null,
          nextReview: new Date().toISOString(),
          easeFactor: 2.5,
          interval: 1
        };

        setWords([...words, word]);
        setNewWord({
          english: '',
          korean: '',
          pronunciation: '',
          example: '',
          difficulty: 'beginner'
        });
        setCurrentPage('list');
      };

      // 번역 (양방향)
      const translateWord = async () => {
        const inputValue = translationMode === 'en-to-ko' ? newWord.english : newWord.korean;

        if (!inputValue.trim()) {
          alert(translationMode === 'en-to-ko' ? '영단어를 입력해주세요!' : '한글 뜻을 입력해주세요!');
          return;
        }

        setIsTranslating(true);
        try {
          const prompt = translationMode === 'en-to-ko'
            ? `영단어 "${newWord.english}"에 대해 다음 정보를 JSON 형식으로 제공해주세요:
{
  "korean": "한국어 뜻 (간단명료하게)",
  "pronunciation": "한글 발음",
  "example": "간단한 영어 예문 1개"
}
반드시 JSON만 출력하세요.`
            : `한국어 뜻 "${newWord.korean}"에 해당하는 영단어와 정보를 JSON 형식으로 제공해주세요:
{
  "english": "가장 적합한 영단어 1개",
  "pronunciation": "한글 발음",
  "example": "간단한 영어 예문 1개"
}
반드시 JSON만 출력하세요.`;

          const response = await fetch("/api/openai", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "gpt-4o",
              max_tokens: 1000,
              response_format: { type: "json_object" },
              messages: [{
                role: "user",
                content: prompt
              }]
            })
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || `API 오류: ${response.status}`);
          }

          if (!data.choices || !data.choices[0]) {
            throw new Error('API 응답 형식 오류');
          }

          let responseText = data.choices[0].message.content;
          const translation = JSON.parse(responseText);
          
          if (translationMode === 'en-to-ko') {
            setNewWord({
              ...newWord,
              korean: translation.korean || '',
              pronunciation: translation.pronunciation || '',
              example: translation.example || ''
            });
          } else {
            setNewWord({
              ...newWord,
              english: translation.english || '',
              pronunciation: translation.pronunciation || '',
              example: translation.example || ''
            });
          }
        } catch (error) {
          console.error('번역 오류:', error);
          alert('번역 중 오류가 발생했습니다.');
        } finally {
          setIsTranslating(false);
        }
      };

      // 단어 복사
      const copyWord = (word) => {
        const text = `${word.english} - ${word.korean}${word.pronunciation ? ' (' + word.pronunciation + ')' : ''}${word.example ? '\n예문: ' + word.example : ''}`;

        navigator.clipboard.writeText(text).then(() => {
          alert('📋 복사되었습니다!');
        }).catch(() => {
          // 클립보드 실패 시 fallback
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          alert('📋 복사되었습니다!');
        });
      };

      // 단어 삭제
      const deleteWord = (id) => {
        if (confirm('정말 삭제하시겠습니까?')) {
          setWords(words.filter(w => w.id !== id));
        }
      };

      // Spaced Repetition
      const updateSpacedRepetition = (wordId, quality) => {
        setWords(words.map(w => {
          if (w.id !== wordId) return w;

          let newEaseFactor = w.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
          if (newEaseFactor < 1.3) newEaseFactor = 1.3;

          let newInterval;
          if (quality < 3) {
            newInterval = 1;
          } else {
            if (w.interval === 1) {
              newInterval = 6;
            } else {
              newInterval = Math.round(w.interval * newEaseFactor);
            }
          }

          const nextReview = new Date();
          nextReview.setDate(nextReview.getDate() + newInterval);

          return {
            ...w,
            easeFactor: newEaseFactor,
            interval: newInterval,
            nextReview: nextReview.toISOString(),
            lastReviewed: new Date().toISOString()
          };
        }));
      };

      const getDueWords = () => {
        const now = new Date();
        return words.filter(w => new Date(w.nextReview) <= now);
      };

      // 플래시카드
      const flipCard = () => setIsFlipped(!isFlipped);

      const markCardQuality = (quality) => {
        const currentWord = words[currentCardIndex];
        updateSpacedRepetition(currentWord.id, quality);
        nextCard();
      };

      const nextCard = () => {
        setIsFlipped(false);
        setCurrentCardIndex((prev) => (prev + 1) % words.length);
      };

      const prevCard = () => {
        setIsFlipped(false);
        setCurrentCardIndex((prev) => (prev - 1 + words.length) % words.length);
      };

      const startStudy = () => {
        if (words.length === 0) {
          alert('학습할 단어가 없습니다!');
          return;
        }
        setCurrentCardIndex(0);
        setIsFlipped(false);
        setCurrentPage('study');
      };

      // 문제풀이
      const startTest = (mode) => {
        if (words.length < 4) {
          alert('최소 4개의 단어가 필요합니다!');
          return;
        }

        setTestMode(mode);
        const shuffled = [...words].sort(() => Math.random() - 0.5);
        const questions = shuffled.slice(0, Math.min(10, words.length));
        
        if (mode === 'multiple') {
          const questionsWithOptions = questions.map(q => {
            const wrongAnswers = words
              .filter(w => w.id !== q.id)
              .sort(() => Math.random() - 0.5)
              .slice(0, 3)
              .map(w => w.korean);
            
            const options = [q.korean, ...wrongAnswers].sort(() => Math.random() - 0.5);
            return { ...q, options };
          });
          setTestQuestions(questionsWithOptions);
        } else {
          setTestQuestions(questions);
        }
        
        setCurrentQuestionIndex(0);
        setUserAnswer('');
        setShowAnswer(false);
        setTestResults([]);
        setCurrentPage('test');
      };

      const submitAnswer = () => {
        const currentQ = testQuestions[currentQuestionIndex];
        const isCorrect = testMode === 'multiple'
          ? userAnswer === currentQ.korean
          : userAnswer.toLowerCase().trim() === currentQ.english.toLowerCase().trim();

        setTestResults([...testResults, {
          word: currentQ,
          userAnswer,
          isCorrect
        }]);

        const quality = isCorrect ? 5 : 0;
        updateSpacedRepetition(currentQ.id, quality);

        setWords(words.map(w => {
          if (w.id === currentQ.id) {
            return {
              ...w,
              learnCount: w.learnCount + 1,
              correctCount: w.correctCount + (isCorrect ? 1 : 0)
            };
          }
          return w;
        }));

        setShowAnswer(true);
      };

      const nextQuestion = () => {
        if (currentQuestionIndex < testQuestions.length - 1) {
          setCurrentQuestionIndex(currentQuestionIndex + 1);
          setUserAnswer('');
          setShowAnswer(false);
        } else {
          setCurrentPage('testResult');
        }
      };

      // 통계
      const getStats = () => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const todayWords = words.filter(w => {
          if (!w.lastReviewed) return false;
          const reviewDate = new Date(w.lastReviewed);
          reviewDate.setHours(0, 0, 0, 0);
          return reviewDate.getTime() === today.getTime();
        });

        const totalLearnCount = words.reduce((sum, w) => sum + w.learnCount, 0);
        const totalCorrect = words.reduce((sum, w) => sum + w.correctCount, 0);
        const accuracy = totalLearnCount > 0 ? Math.round((totalCorrect / totalLearnCount) * 100) : 0;

        const byDifficulty = {
          beginner: words.filter(w => w.difficulty === 'beginner').length,
          intermediate: words.filter(w => w.difficulty === 'intermediate').length,
          advanced: words.filter(w => w.difficulty === 'advanced').length
        };

        return {
          todayCount: todayWords.length,
          totalWords: words.length,
          accuracy,
          dueWords: getDueWords().length,
          byDifficulty
        };
      };

      // AI 무제한 추천 (실시간 생성)
      const getRecommendations = async () => {
        setIsLoadingRecommendations(true);
        try {
          const stats = getStats();
          const weakDifficulties = [];

          Object.entries(stats.byDifficulty).forEach(([diff, count]) => {
            if (count < 10) weakDifficulties.push(diff);
          });

          // 이미 등록된 단어 목록
          const registeredWords = words.map(w => w.english.toLowerCase());

          const response = await fetch("/api/openai", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "gpt-4o",
              max_tokens: 2000,
              response_format: { type: "json_object" },
              messages: [{
                role: "user",
                content: `사용자의 영단어 학습 분석:

**현재 통계:**
- 총 단어 수: ${stats.totalWords}개
- 전체 정답률: ${stats.accuracy}%
- 난이도별 현황:
  • 초급: ${stats.byDifficulty.beginner}개
  • 중급: ${stats.byDifficulty.intermediate}개
  • 고급: ${stats.byDifficulty.advanced}개
- 부족한 난이도: ${weakDifficulties.join(', ') || '균형 잡힘'}

**이미 등록된 단어 (중복 제외):**
${registeredWords.slice(0, 50).join(', ')}${registeredWords.length > 50 ? '...' : ''}

위 정보를 바탕으로 사용자에게 **실용적이고 중요한** 영단어 5개를 새롭게 생성하여 추천해주세요.

추천 기준:
1. 위에 나열된 단어들과 **절대 중복되지 않는** 새로운 단어
2. 부족한 난이도 우선 고려
3. 실생활에서 자주 사용하는 단어
4. 토익, 토플, 수능 등 시험에 자주 나오는 단어
5. 난이도 균형 고려

다음 JSON 형식으로 반환:
{
  "recommendations": [
    {
      "english": "단어1",
      "korean": "한글 뜻",
      "pronunciation": "한글 발음",
      "example": "간단한 예문",
      "difficulty": "beginner/intermediate/advanced"
    },
    ... 5개
  ],
  "reason": "이 단어들을 추천하는 이유를 한 문장으로"
}

**중요: 반드시 JSON만 출력하세요. 다른 설명은 제외하세요.**`
              }]
            })
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || `API 오류: ${response.status}`);
          }

          if (!data.choices || !data.choices[0]) {
            throw new Error('API 응답 형식 오류');
          }

          let responseText = data.choices[0].message.content;

          const result = JSON.parse(responseText);
          
          // 중복 체크 (안전장치)
          const uniqueRecommendations = result.recommendations.filter(word => 
            !registeredWords.includes(word.english.toLowerCase())
          );

          setRecommendations({
            words: uniqueRecommendations,
            reason: result.reason
          });
        } catch (error) {
          console.error('AI 추천 오류:', error);
          alert('AI 추천 중 오류가 발생했습니다. 다시 시도해주세요.');
          setRecommendations([]);
        } finally {
          setIsLoadingRecommendations(false);
        }
      };

      const addRecommendedWord = (word) => {
        const newWord = {
          id: Date.now(),
          ...word,
          learnCount: 0,
          correctCount: 0,
          lastReviewed: null,
          nextReview: new Date().toISOString(),
          easeFactor: 2.5,
          interval: 1
        };

        setWords([...words, newWord]);
        setRecommendations({
          ...recommendations,
          words: recommendations.words.filter(w => w.english !== word.english)
        });
      };

      // JSON 다운로드
      const downloadData = () => {
        const data = {
          words,
          exportDate: new Date().toISOString(),
          version: '1.0'
        };
        
        const jsonString = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `vocabulary_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      // JSON 업로드
      const uploadData = (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            if (data.words && Array.isArray(data.words)) {
              setWords(data.words);
              alert(`${data.words.length}개의 단어를 불러왔습니다!`);
            } else {
              alert('올바르지 않은 파일 형식입니다.');
            }
          } catch (error) {
            alert('파일을 읽는 중 오류가 발생했습니다.');
          }
        };
        reader.readAsText(file);
      };

      // 유틸리티
      const getDifficultyColor = (difficulty) => {
        const colors = {
          beginner: 'bg-green-100 text-green-800',
          intermediate: 'bg-yellow-100 text-yellow-800',
          advanced: 'bg-red-100 text-red-800'
        };
        return colors[difficulty] || colors.beginner;
      };

      const getDifficultyText = (difficulty) => {
        const text = {
          beginner: '초급',
          intermediate: '중급',
          advanced: '고급'
        };
        return text[difficulty] || '초급';
      };

      const NavButton = ({ page, label, icon }) => (
        <button
          onClick={() => setCurrentPage(page)}
          className={`flex items-center gap-2 px-4 py-2 rounded-lg transition ${
            currentPage === page ? 'bg-blue-500 text-white' : 'bg-gray-100 hover:bg-gray-200'
          }`}
        >
          {icon} {label}
        </button>
      );

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6">
          <div className="max-w-6xl mx-auto">
            {/* 헤더 */}
            <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
              <div className="flex items-center justify-between mb-6">
                <div className="flex items-center gap-3">
                  <span className="text-4xl">🎓</span>
                  <div>
                    <h1 className="text-3xl font-bold text-gray-800">AI 단어 암기장</h1>
                    <p className="text-sm text-green-600 font-semibold">💾 자동 저장 | 🤖 무제한 AI 생성</p>
                  </div>
                </div>
                <div className="flex items-center gap-4">
                  <div className="flex gap-2">
                    <button
                      onClick={downloadData}
                      className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition text-sm"
                      title="백업"
                    >
                      💾 백업
                    </button>
                    <label className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition cursor-pointer text-sm">
                      📤 복원
                      <input type="file" accept=".json" onChange={uploadData} className="hidden" />
                    </label>
                  </div>
                  <div className="text-right">
                    <p className="text-sm text-gray-600">단어</p>
                    <p className="text-2xl font-bold text-blue-500">{words.length}개</p>
                  </div>
                </div>
              </div>

              {/* 네비게이션 */}
              <div className="flex gap-3 flex-wrap">
                <NavButton page="list" icon="📚" label="목록" />
                <NavButton page="add" icon="➕" label="추가" />
                <button
                  onClick={startStudy}
                  className="flex items-center gap-2 px-4 py-2 rounded-lg transition bg-purple-500 text-white hover:bg-purple-600"
                >
                  📖 학습
                </button>
                <NavButton page="testMenu" icon="✍️" label="문제" />
                <NavButton page="stats" icon="📊" label="통계" />
                <button
                  onClick={() => {
                    setCurrentPage('recommend');
                    if (recommendations.length === 0) getRecommendations();
                  }}
                  className="flex items-center gap-2 px-4 py-2 rounded-lg transition bg-gradient-to-r from-pink-500 to-purple-500 text-white hover:from-pink-600 hover:to-purple-600"
                >
                  🤖 AI 추천
                </button>
              </div>
            </div>

            {/* 메인 컨텐츠 */}
            <div className="bg-white rounded-2xl shadow-lg p-6">
              {/* 단어 목록 */}
              {currentPage === 'list' && (
                <div>
                  <h2 className="text-2xl font-bold mb-4">📚 단어 목록</h2>
                  {words.length === 0 ? (
                    <div className="text-center py-12 text-gray-400">
                      <p className="text-6xl mb-4">📖</p>
                      <p>등록된 단어가 없습니다.</p>
                      <p className="text-sm">단어를 추가하거나 AI 추천을 받아보세요!</p>
                    </div>
                  ) : (
                    <div className="space-y-4">
                      {words.map(word => (
                        <div key={word.id} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                          <div className="flex justify-between items-start">
                            <div className="flex-1">
                              <div className="flex items-center gap-3 mb-2">
                                <h3 className="text-xl font-bold">{word.english}</h3>
                                <span className={`px-3 py-1 rounded-full text-xs font-semibold ${getDifficultyColor(word.difficulty)}`}>
                                  {getDifficultyText(word.difficulty)}
                                </span>
                              </div>
                              <p className="text-lg mb-1">🇰🇷 {word.korean}</p>
                              {word.pronunciation && <p className="text-sm text-gray-500 mb-2">🔊 {word.pronunciation}</p>}
                              {word.example && <p className="text-sm text-gray-600 italic bg-gray-50 p-2 rounded">💬 {word.example}</p>}
                            </div>
                            <div className="flex gap-2">
                              <button
                                onClick={() => copyWord(word)}
                                className="text-blue-500 hover:bg-blue-50 p-2 rounded-lg transition"
                                title="복사"
                              >
                                📋
                              </button>
                              <button
                                onClick={() => deleteWord(word.id)}
                                className="text-red-500 hover:bg-red-50 p-2 rounded-lg transition"
                                title="삭제"
                              >
                                🗑️
                              </button>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}

              {/* 단어 추가 */}
              {currentPage === 'add' && (
                <div>
                  <h2 className="text-2xl font-bold mb-4">➕ 단어 추가</h2>
                  
                  {/* 번역 모드 선택 */}
                  <div className="mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border-2 border-blue-200">
                    <p className="text-sm font-semibold mb-3 text-gray-700">🔄 번역 방향 선택</p>
                    <div className="flex gap-3">
                      <button
                        onClick={() => setTranslationMode('en-to-ko')}
                        className={`flex-1 py-3 rounded-lg font-semibold transition ${
                          translationMode === 'en-to-ko'
                            ? 'bg-blue-500 text-white'
                            : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        🇬🇧 영어 → 한글
                      </button>
                      <button
                        onClick={() => setTranslationMode('ko-to-en')}
                        className={`flex-1 py-3 rounded-lg font-semibold transition ${
                          translationMode === 'ko-to-en'
                            ? 'bg-blue-500 text-white'
                            : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        🇰🇷 한글 → 영어
                      </button>
                    </div>
                  </div>

                  <div className="space-y-4">
                    {translationMode === 'en-to-ko' ? (
                      <>
                        {/* 영어 → 한글 모드 */}
                        <div>
                          <label className="block text-sm font-semibold mb-2">영단어 *</label>
                          <div className="flex gap-2">
                            <input
                              type="text"
                              value={newWord.english}
                              onChange={(e) => setNewWord({...newWord, english: e.target.value})}
                              className="flex-1 px-4 py-2 border rounded-lg"
                              placeholder="예: ephemeral"
                            />
                            <button
                              onClick={translateWord}
                              disabled={isTranslating}
                              className="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition disabled:bg-gray-300"
                            >
                              {isTranslating ? '번역중...' : '🌐 번역'}
                            </button>
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-2">한국어 뜻 *</label>
                          <input
                            type="text"
                            value={newWord.korean}
                            onChange={(e) => setNewWord({...newWord, korean: e.target.value})}
                            className="w-full px-4 py-2 border rounded-lg"
                          />
                        </div>
                      </>
                    ) : (
                      <>
                        {/* 한글 → 영어 모드 */}
                        <div>
                          <label className="block text-sm font-semibold mb-2">한국어 뜻 *</label>
                          <div className="flex gap-2">
                            <input
                              type="text"
                              value={newWord.korean}
                              onChange={(e) => setNewWord({...newWord, korean: e.target.value})}
                              className="flex-1 px-4 py-2 border rounded-lg"
                              placeholder="예: 일시적인, 덧없는"
                            />
                            <button
                              onClick={translateWord}
                              disabled={isTranslating}
                              className="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition disabled:bg-gray-300"
                            >
                              {isTranslating ? '번역중...' : '🌐 번역'}
                            </button>
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-2">영단어 *</label>
                          <input
                            type="text"
                            value={newWord.english}
                            onChange={(e) => setNewWord({...newWord, english: e.target.value})}
                            className="w-full px-4 py-2 border rounded-lg"
                          />
                        </div>
                      </>
                    )}

                    <div>
                      <label className="block text-sm font-semibold mb-2">한글 발음</label>
                      <input
                        type="text"
                        value={newWord.pronunciation}
                        onChange={(e) => setNewWord({...newWord, pronunciation: e.target.value})}
                        className="w-full px-4 py-2 border rounded-lg"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-semibold mb-2">예문</label>
                      <textarea
                        value={newWord.example}
                        onChange={(e) => setNewWord({...newWord, example: e.target.value})}
                        className="w-full px-4 py-2 border rounded-lg"
                        rows="3"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-semibold mb-2">난이도</label>
                      <select
                        value={newWord.difficulty}
                        onChange={(e) => setNewWord({...newWord, difficulty: e.target.value})}
                        className="w-full px-4 py-2 border rounded-lg"
                      >
                        <option value="beginner">초급</option>
                        <option value="intermediate">중급</option>
                        <option value="advanced">고급</option>
                      </select>
                    </div>
                    <div className="flex gap-3 pt-4">
                      <button
                        onClick={addWord}
                        className="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition font-semibold"
                      >
                        단어 추가
                      </button>
                      <button
                        onClick={() => setCurrentPage('list')}
                        className="px-6 bg-gray-200 py-3 rounded-lg hover:bg-gray-300 transition font-semibold"
                      >
                        취소
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* 학습 모드 */}
              {currentPage === 'study' && words.length > 0 && (
                <div>
                  <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold">📖 학습 모드</h2>
                    <div className="text-sm text-gray-600">
                      {currentCardIndex + 1} / {words.length}
                    </div>
                  </div>

                  <div className="max-w-2xl mx-auto">
                    <div 
                      onClick={flipCard}
                      className={`flip-card ${isFlipped ? 'flipped' : ''} cursor-pointer mb-8`}
                    >
                      <div className="flip-card-inner relative h-96">
                        <div className="flip-card-front absolute w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl shadow-2xl flex items-center justify-center p-8">
                          <div className="text-center text-white">
                            <p className="text-6xl font-bold mb-4">{words[currentCardIndex].english}</p>
                            <span className={`px-4 py-2 rounded-full text-sm font-semibold ${getDifficultyColor(words[currentCardIndex].difficulty)}`}>
                              {getDifficultyText(words[currentCardIndex].difficulty)}
                            </span>
                            <p className="mt-8 text-white/70">카드를 클릭하여 뜻 보기</p>
                          </div>
                        </div>

                        <div className="flip-card-back absolute w-full h-full bg-gradient-to-br from-green-500 to-teal-600 rounded-2xl shadow-2xl p-8">
                          <div className="text-white h-full flex flex-col justify-center">
                            <h3 className="text-4xl font-bold mb-4 text-center">{words[currentCardIndex].english}</h3>
                            <div className="space-y-4 bg-white/10 rounded-xl p-6 backdrop-blur">
                              <div>
                                <p className="text-sm opacity-80">한국어 뜻</p>
                                <p className="text-2xl font-semibold">{words[currentCardIndex].korean}</p>
                              </div>
                              {words[currentCardIndex].pronunciation && (
                                <div>
                                  <p className="text-sm opacity-80">발음</p>
                                  <p className="text-xl">{words[currentCardIndex].pronunciation}</p>
                                </div>
                              )}
                              {words[currentCardIndex].example && (
                                <div>
                                  <p className="text-sm opacity-80">예문</p>
                                  <p className="text-lg italic">{words[currentCardIndex].example}</p>
                                </div>
                              )}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div className="flex justify-between items-center mb-4">
                      <button onClick={prevCard} className="px-6 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">← 이전</button>
                      <button onClick={flipCard} className="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold">카드 뒤집기</button>
                      <button onClick={nextCard} className="px-6 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">다음 →</button>
                    </div>

                    {isFlipped && (
                      <div className="p-4 bg-gray-50 rounded-xl mb-4">
                        <p className="text-sm text-gray-600 mb-3 text-center">얼마나 잘 기억하셨나요?</p>
                        <div className="grid grid-cols-3 gap-2">
                          <button onClick={() => markCardQuality(0)} className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm">❌ 모름</button>
                          <button onClick={() => markCardQuality(3)} className="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 text-sm">🤔 어려움</button>
                          <button onClick={() => markCardQuality(5)} className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm">✅ 완벽</button>
                        </div>
                      </div>
                    )}

                    <button onClick={() => setCurrentPage('list')} className="w-full px-6 py-3 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg font-semibold">학습 종료</button>
                  </div>
                </div>
              )}

              {/* 문제풀이 메뉴 */}
              {currentPage === 'testMenu' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">✍️ 문제풀이 모드</h2>
                  <div className="grid md:grid-cols-2 gap-6 max-w-3xl mx-auto">
                    <div onClick={() => startTest('multiple')} className="bg-gradient-to-br from-blue-50 to-blue-100 p-8 rounded-2xl border-2 border-blue-200 hover:border-blue-400 cursor-pointer transition hover:shadow-lg">
                      <div className="text-5xl mb-4">📝</div>
                      <h3 className="text-2xl font-bold mb-2">객관식</h3>
                      <p className="text-gray-600">4개의 보기 중 정답 선택</p>
                    </div>
                    <div onClick={() => startTest('written')} className="bg-gradient-to-br from-green-50 to-green-100 p-8 rounded-2xl border-2 border-green-200 hover:border-green-400 cursor-pointer transition hover:shadow-lg">
                      <div className="text-5xl mb-4">✏️</div>
                      <h3 className="text-2xl font-bold mb-2">주관식</h3>
                      <p className="text-gray-600">뜻을 보고 영단어 입력</p>
                    </div>
                  </div>
                </div>
              )}

              {/* 문제풀이 */}
              {currentPage === 'test' && testQuestions.length > 0 && (
                <div>
                  <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold">{testMode === 'multiple' ? '📝 객관식' : '✏️ 주관식'}</h2>
                    <div className="text-sm text-gray-600">{currentQuestionIndex + 1} / {testQuestions.length}</div>
                  </div>

                  <div className="max-w-2xl mx-auto">
                    <div className="bg-gradient-to-br from-purple-50 to-pink-50 p-8 rounded-2xl border-2 border-purple-200 mb-6">
                      {testMode === 'multiple' ? (
                        <>
                          <p className="text-gray-600 mb-4">다음 단어의 뜻은?</p>
                          <h3 className="text-4xl font-bold mb-6">{testQuestions[currentQuestionIndex].english}</h3>
                          <div className="space-y-3">
                            {testQuestions[currentQuestionIndex].options.map((option, idx) => (
                              <button
                                key={idx}
                                onClick={() => !showAnswer && setUserAnswer(option)}
                                disabled={showAnswer}
                                className={`w-full p-4 rounded-lg text-left transition ${
                                  showAnswer
                                    ? option === testQuestions[currentQuestionIndex].korean
                                      ? 'bg-green-500 text-white'
                                      : userAnswer === option ? 'bg-red-500 text-white' : 'bg-gray-100'
                                    : userAnswer === option ? 'bg-blue-500 text-white' : 'bg-white hover:bg-gray-50 border-2 border-gray-200'
                                }`}
                              >
                                {option}
                              </button>
                            ))}
                          </div>
                        </>
                      ) : (
                        <>
                          <p className="text-gray-600 mb-4">다음 뜻에 해당하는 영단어는?</p>
                          <h3 className="text-3xl font-bold mb-6">{testQuestions[currentQuestionIndex].korean}</h3>
                          {testQuestions[currentQuestionIndex].pronunciation && (
                            <p className="text-gray-600 mb-4">발음: {testQuestions[currentQuestionIndex].pronunciation}</p>
                          )}
                          <input
                            type="text"
                            value={userAnswer}
                            onChange={(e) => setUserAnswer(e.target.value)}
                            disabled={showAnswer}
                            className="w-full p-4 text-2xl border-2 rounded-lg"
                            placeholder="영단어를 입력하세요"
                            onKeyPress={(e) => e.key === 'Enter' && !showAnswer && userAnswer && submitAnswer()}
                          />
                        </>
                      )}
                    </div>

                    {showAnswer && (
                      <div className={`p-6 rounded-xl mb-6 ${testResults[testResults.length - 1].isCorrect ? 'bg-green-100 border-2 border-green-500' : 'bg-red-100 border-2 border-red-500'}`}>
                        <p className="text-2xl font-bold mb-2">{testResults[testResults.length - 1].isCorrect ? '✅ 정답!' : '❌ 오답'}</p>
                        <p className="text-lg">정답: <strong>{testQuestions[currentQuestionIndex][testMode === 'multiple' ? 'korean' : 'english']}</strong></p>
                      </div>
                    )}

                    <div className="flex gap-3">
                      {!showAnswer ? (
                        <button onClick={submitAnswer} disabled={!userAnswer} className="flex-1 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 font-semibold disabled:bg-gray-300">제출</button>
                      ) : (
                        <button onClick={nextQuestion} className="flex-1 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold">
                          {currentQuestionIndex < testQuestions.length - 1 ? '다음 문제' : '결과 보기'}
                        </button>
                      )}
                      <button onClick={() => setCurrentPage('testMenu')} className="px-6 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">종료</button>
                    </div>
                  </div>
                </div>
              )}

              {/* 테스트 결과 */}
              {currentPage === 'testResult' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6 text-center">📊 테스트 결과</h2>
                  <div className="max-w-2xl mx-auto">
                    <div className="bg-gradient-to-br from-blue-500 to-purple-600 text-white p-8 rounded-2xl mb-6 text-center">
                      <p className="text-xl mb-2">총 {testResults.length}문제</p>
                      <p className="text-5xl font-bold mb-2">{testResults.filter(r => r.isCorrect).length} / {testResults.length}</p>
                      <p className="text-2xl">정답률: {Math.round((testResults.filter(r => r.isCorrect).length / testResults.length) * 100)}%</p>
                    </div>

                    <div className="space-y-3 mb-6">
                      {testResults.map((result, idx) => (
                        <div key={idx} className={`p-4 rounded-lg border-2 ${result.isCorrect ? 'bg-green-50 border-green-300' : 'bg-red-50 border-red-300'}`}>
                          <p className="font-bold text-lg">{result.isCorrect ? '✅' : '❌'} {result.word.english}</p>
                          <p className="text-gray-600">정답: {testMode === 'multiple' ? result.word.korean : result.word.english}</p>
                          {!result.isCorrect && <p className="text-red-600 text-sm">입력: {result.userAnswer}</p>}
                        </div>
                      ))}
                    </div>

                    <div className="flex gap-3">
                      <button onClick={() => startTest(testMode)} className="flex-1 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold">다시 풀기</button>
                      <button onClick={() => setCurrentPage('testMenu')} className="flex-1 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">메뉴로</button>
                    </div>
                  </div>
                </div>
              )}

              {/* 통계 */}
              {currentPage === 'stats' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">📊 학습 통계</h2>
                  {(() => {
                    const stats = getStats();
                    return (
                      <div className="max-w-4xl mx-auto space-y-6">
                        <div className="grid md:grid-cols-4 gap-4">
                          <div className="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">오늘 학습</p>
                            <p className="text-4xl font-bold">{stats.todayCount}</p>
                            <p className="text-sm opacity-80">단어</p>
                          </div>
                          <div className="bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">전체 정답률</p>
                            <p className="text-4xl font-bold">{stats.accuracy}%</p>
                          </div>
                          <div className="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">총 단어</p>
                            <p className="text-4xl font-bold">{stats.totalWords}</p>
                          </div>
                          <div className="bg-gradient-to-br from-orange-500 to-orange-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">복습 필요</p>
                            <p className="text-4xl font-bold">{stats.dueWords}</p>
                          </div>
                        </div>

                        <div className="bg-white p-6 rounded-xl border-2">
                          <h3 className="text-xl font-bold mb-4">📈 난이도별 분포</h3>
                          <div className="space-y-3">
                            {Object.entries(stats.byDifficulty).map(([diff, count]) => (
                              <div key={diff} className="flex items-center gap-3">
                                <div className="w-24 text-sm font-semibold">{getDifficultyText(diff)}</div>
                                <div className="flex-1 bg-gray-200 rounded-full h-8">
                                  <div 
                                    className={`h-8 rounded-full flex items-center justify-end pr-3 text-white font-semibold text-sm ${
                                      diff === 'beginner' ? 'bg-green-500' : diff === 'intermediate' ? 'bg-yellow-500' : 'bg-red-500'
                                    }`}
                                    style={{ width: `${stats.totalWords > 0 ? (count / stats.totalWords) * 100 : 0}%` }}
                                  >
                                    {count}개
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>

                        {getDueWords().length > 0 && (
                          <div className="bg-orange-50 p-6 rounded-xl border-2 border-orange-300">
                            <h3 className="text-xl font-bold mb-4">🔔 복습 필요 단어</h3>
                            <div className="space-y-2 max-h-64 overflow-y-auto">
                              {getDueWords().map(word => (
                                <div key={word.id} className="bg-white p-3 rounded-lg border">
                                  <span className="font-bold">{word.english}</span> - {word.korean}
                                </div>
                              ))}
                            </div>
                            <button onClick={startStudy} className="w-full mt-4 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-semibold">지금 복습하기</button>
                          </div>
                        )}
                      </div>
                    );
                  })()}
                </div>
              )}

              {/* AI 무제한 추천 */}
              {currentPage === 'recommend' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">🤖 AI 무제한 단어 추천</h2>
                  <div className="max-w-3xl mx-auto">
                    {recommendations.length === 0 ? (
                      <div className="text-center py-12">
                        <div className="text-6xl mb-4">🤖</div>
                        <h3 className="text-xl font-bold mb-4">
                          AI가 학습 패턴을 분석하여<br />
                          <span className="text-pink-600">무제한으로</span> 새로운 단어를 생성합니다
                        </h3>
                        <p className="text-gray-600 mb-6">
                          실시간으로 맞춤형 단어를 추천받으세요!
                        </p>
                        <button
                          onClick={getRecommendations}
                          disabled={isLoadingRecommendations}
                          className="px-8 py-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-xl hover:from-pink-600 hover:to-purple-700 font-semibold text-lg disabled:opacity-50"
                        >
                          {isLoadingRecommendations ? '🔄 AI 분석 중...' : '✨ 오늘의 추천 단어 받기'}
                        </button>
                      </div>
                    ) : (
                      <div>
                        <div className="bg-gradient-to-r from-pink-50 to-purple-50 p-6 rounded-xl border-2 border-purple-200 mb-6">
                          <p className="text-gray-700"><strong>💡 AI 추천 이유:</strong> {recommendations.reason}</p>
                        </div>

                        <div className="space-y-4 mb-6">
                          {recommendations.words && recommendations.words.map((word, idx) => (
                            <div key={idx} className="bg-white p-6 rounded-xl border-2 hover:border-purple-400 transition">
                              <div className="flex items-center gap-3 mb-2">
                                <h3 className="text-2xl font-bold">{word.english}</h3>
                                <span className={`px-3 py-1 rounded-full text-xs font-semibold ${getDifficultyColor(word.difficulty)}`}>
                                  {getDifficultyText(word.difficulty)}
                                </span>
                              </div>
                              <p className="text-lg mb-2">🇰🇷 {word.korean}</p>
                              <p className="text-sm text-gray-500 mb-2">🔊 {word.pronunciation}</p>
                              <p className="text-sm text-gray-600 italic bg-gray-50 p-3 rounded mb-3">💬 {word.example}</p>
                              <button
                                onClick={() => addRecommendedWord(word)}
                                className="w-full py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 font-semibold"
                              >
                                ➕ 단어장에 추가
                              </button>
                            </div>
                          ))}
                        </div>

                        <button
                          onClick={getRecommendations}
                          disabled={isLoadingRecommendations}
                          className="w-full py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold disabled:opacity-50"
                        >
                          {isLoadingRecommendations ? '🔄 AI 분석 중...' : '🔄 다른 단어 추천 받기 (무제한)'}
                        </button>

                        <div className="mt-6 p-4 bg-green-50 rounded-lg border border-green-200">
                          <p className="text-sm text-gray-700 text-center">
                            ✨ <strong>무제한 생성:</strong> AI가 실시간으로 새로운 단어를 계속 추천합니다!
                          </p>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<VocabApp />, document.getElementById('root'));
  </script>
</body>
</html>