<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI ë‹¨ì–´ ì•”ê¸°ì¥ - ë¬´ì œí•œ AI ìƒì„±</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .flip-card {
      perspective: 1000px;
    }
    .flip-card-inner {
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .flip-card.flipped .flip-card-inner {
      transform: rotateY(180deg);
    }
    .flip-card-front, .flip-card-back {
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }
    .flip-card-back {
      transform: rotateY(180deg);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function VocabApp() {
      // LocalStorageì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
      const loadFromStorage = () => {
        try {
          const saved = localStorage.getItem('vocabWords');
          if (saved) {
            return JSON.parse(saved);
          }
        } catch (error) {
          console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
        }
        return [];
      };

      // í•™ìŠµ ê¸°ë¡ ë¡œë“œ
      const loadStudyHistory = () => {
        try {
          const saved = localStorage.getItem('studyHistory');
          if (saved) {
            return JSON.parse(saved);
          }
        } catch (error) {
          console.error('í•™ìŠµ ê¸°ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        }
        return {};
      };

      const [words, setWords] = useState(loadFromStorage);
      const [currentPage, setCurrentPage] = useState('list');
      const [newWord, setNewWord] = useState({
        english: '',
        korean: '',
        pronunciation: '',
        phonetic: '',
        example: '',
        difficulty: 'beginner',
        tags: []
      });
      const [isTranslating, setIsTranslating] = useState(false);
      const [translationMode, setTranslationMode] = useState('en-to-ko'); // 'en-to-ko' ë˜ëŠ” 'ko-to-en'
      const [includeExample, setIncludeExample] = useState(false); // ì˜ˆë¬¸ í¬í•¨ ì—¬ë¶€

      // í”Œë˜ì‹œì¹´ë“œ
      const [currentCardIndex, setCurrentCardIndex] = useState(0);
      const [isFlipped, setIsFlipped] = useState(false);

      // ë¬¸ì œí’€ì´
      const [testMode, setTestMode] = useState(null);
      const [testQuestions, setTestQuestions] = useState([]);
      const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
      const [userAnswer, setUserAnswer] = useState('');
      const [showAnswer, setShowAnswer] = useState(false);
      const [testResults, setTestResults] = useState([]);

      // AI ì¶”ì²œ
      const [recommendations, setRecommendations] = useState([]);
      const [isLoadingRecommendations, setIsLoadingRecommendations] = useState(false);

      // ê²€ìƒ‰
      const [searchQuery, setSearchQuery] = useState('');

      // íƒœê·¸ ê´€ë¦¬
      const defaultTags = ['ë¹„ì¦ˆë‹ˆìŠ¤', 'ì—¬í–‰', 'ì‹œí—˜', 'ì¼ìƒ', 'ê¸°íƒ€'];
      const [availableTags, setAvailableTags] = useState(defaultTags);
      const [selectedTagFilter, setSelectedTagFilter] = useState('ì „ì²´');

      // í•™ìŠµ ê¸°ë¡ (ì¼ë³„ í†µê³„)
      const [studyHistory, setStudyHistory] = useState(loadStudyHistory);

      // ì¦ê²¨ì°¾ê¸° í•„í„°
      const [showFavoritesOnly, setShowFavoritesOnly] = useState(false);

      // LocalStorage ìë™ ì €ì¥
      useEffect(() => {
        try {
          localStorage.setItem('vocabWords', JSON.stringify(words));
        } catch (error) {
          console.error('ì €ì¥ ì˜¤ë¥˜:', error);
        }
      }, [words]);

      // í•™ìŠµ ê¸°ë¡ ìë™ ì €ì¥
      useEffect(() => {
        try {
          localStorage.setItem('studyHistory', JSON.stringify(studyHistory));
        } catch (error) {
          console.error('í•™ìŠµ ê¸°ë¡ ì €ì¥ ì˜¤ë¥˜:', error);
        }
      }, [studyHistory]);

      // ë‹¨ì–´ ì¶”ê°€
      const addWord = () => {
        if (!newWord.english || !newWord.korean) {
          alert('ì˜ë‹¨ì–´ì™€ ëœ»ì€ í•„ìˆ˜ì…ë‹ˆë‹¤!');
          return;
        }

        const word = {
          id: Date.now(),
          ...newWord,
          learnCount: 0,
          correctCount: 0,
          wrongCount: 0,
          isFavorite: false,
          lastReviewed: null,
          nextReview: new Date().toISOString(),
          easeFactor: 2.5,
          interval: 1
        };

        setWords([...words, word]);
        setNewWord({
          english: '',
          korean: '',
          pronunciation: '',
          phonetic: '',
          example: '',
          difficulty: 'beginner',
          tags: []
        });
        setCurrentPage('list');
      };

      // ë²ˆì—­ (ì–‘ë°©í–¥) - Gemini API ì‚¬ìš©
      const translateWord = async () => {
        const inputValue = translationMode === 'en-to-ko' ? newWord.english : newWord.korean;

        if (!inputValue.trim()) {
          alert(translationMode === 'en-to-ko' ? 'ì˜ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!' : 'í•œê¸€ ëœ»ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
          return;
        }

        setIsTranslating(true);
        try {
          const exampleInstruction = includeExample ? '"example": "ê°„ë‹¨í•œ ì˜ì–´ ì˜ˆë¬¸ 1ê°œ",' : '';

          const prompt = translationMode === 'en-to-ko'
            ? `ì˜ë‹¨ì–´ "${newWord.english}"ì— ëŒ€í•´ ë‹¤ìŒ ì •ë³´ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ì œê³µí•´ì£¼ì„¸ìš”:
{
  "korean": "í•œêµ­ì–´ ëœ» (ê°„ë‹¨ëª…ë£Œí•˜ê²Œ)",
  "pronunciation": "í•œê¸€ ë°œìŒ",
  "phonetic": "IPA ë°œìŒê¸°í˜¸",
  ${exampleInstruction}
}
ë°˜ë“œì‹œ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”. ë‹¤ë¥¸ ì„¤ëª… ì—†ì´ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`
            : `í•œêµ­ì–´ ëœ» "${newWord.korean}"ì— í•´ë‹¹í•˜ëŠ” ì˜ë‹¨ì–´ì™€ ì •ë³´ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ì œê³µí•´ì£¼ì„¸ìš”:
{
  "english": "ê°€ì¥ ì í•©í•œ ì˜ë‹¨ì–´ 1ê°œ",
  "pronunciation": "í•œê¸€ ë°œìŒ",
  "phonetic": "IPA ë°œìŒê¸°í˜¸",
  ${exampleInstruction}
}
ë°˜ë“œì‹œ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”. ë‹¤ë¥¸ ì„¤ëª… ì—†ì´ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.`;

          const response = await fetch("/.netlify/functions/gemini", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              prompt: prompt
            })
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || `API ì˜¤ë¥˜: ${response.status}`);
          }

          if (!data.text) {
            throw new Error('API ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜');
          }

          let responseText = data.text.trim();
          // JSON ì¶”ì¶œ (ë§ˆí¬ë‹¤ìš´ ì½”ë“œë¸”ë¡ ì œê±°)
          responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();

          const translation = JSON.parse(responseText);
          
          if (translationMode === 'en-to-ko') {
            setNewWord({
              ...newWord,
              korean: translation.korean || '',
              pronunciation: translation.pronunciation || '',
              phonetic: translation.phonetic || '',
              example: translation.example || ''
            });
          } else {
            setNewWord({
              ...newWord,
              english: translation.english || '',
              pronunciation: translation.pronunciation || '',
              phonetic: translation.phonetic || '',
              example: translation.example || ''
            });
          }
        } catch (error) {
          console.error('ë²ˆì—­ ì˜¤ë¥˜:', error);
          alert('ë²ˆì—­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        } finally {
          setIsTranslating(false);
        }
      };

      // ë‹¨ì–´ ë³µì‚¬
      const copyWord = (word) => {
        const text = word.english;

        navigator.clipboard.writeText(text).then(() => {
          alert('ğŸ“‹ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }).catch(() => {
          // í´ë¦½ë³´ë“œ ì‹¤íŒ¨ ì‹œ fallback
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          alert('ğŸ“‹ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });
      };

      // ë‹¨ì–´ ì‚­ì œ
      const deleteWord = (id) => {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          setWords(words.filter(w => w.id !== id));
        }
      };

      // ì¦ê²¨ì°¾ê¸° í† ê¸€
      const toggleFavorite = (id) => {
        setWords(words.map(w =>
          w.id === id ? {...w, isFavorite: !w.isFavorite} : w
        ));
      };

      // í•™ìŠµ ê¸°ë¡ ì €ì¥
      const recordStudy = (count, correct) => {
        const today = new Date().toISOString().split('T')[0];
        setStudyHistory(prev => ({
          ...prev,
          [today]: {
            count: (prev[today]?.count || 0) + count,
            correct: (prev[today]?.correct || 0) + correct,
            accuracy: Math.round(((prev[today]?.correct || 0) + correct) / ((prev[today]?.count || 0) + count) * 100)
          }
        }));
      };

      // Spaced Repetition
      const updateSpacedRepetition = (wordId, quality) => {
        setWords(words.map(w => {
          if (w.id !== wordId) return w;

          let newEaseFactor = w.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
          if (newEaseFactor < 1.3) newEaseFactor = 1.3;

          let newInterval;
          if (quality < 3) {
            newInterval = 1;
          } else {
            if (w.interval === 1) {
              newInterval = 6;
            } else {
              newInterval = Math.round(w.interval * newEaseFactor);
            }
          }

          const nextReview = new Date();
          nextReview.setDate(nextReview.getDate() + newInterval);

          return {
            ...w,
            easeFactor: newEaseFactor,
            interval: newInterval,
            nextReview: nextReview.toISOString(),
            lastReviewed: new Date().toISOString()
          };
        }));
      };

      const getDueWords = () => {
        const now = new Date();
        return words.filter(w => new Date(w.nextReview) <= now);
      };

      // í”Œë˜ì‹œì¹´ë“œ
      const flipCard = () => setIsFlipped(!isFlipped);

      const markCardQuality = (quality) => {
        const currentWord = words[currentCardIndex];
        updateSpacedRepetition(currentWord.id, quality);
        nextCard();
      };

      const nextCard = () => {
        setIsFlipped(false);
        setCurrentCardIndex((prev) => (prev + 1) % words.length);
      };

      const prevCard = () => {
        setIsFlipped(false);
        setCurrentCardIndex((prev) => (prev - 1 + words.length) % words.length);
      };

      const startStudy = () => {
        if (words.length === 0) {
          alert('í•™ìŠµí•  ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤!');
          return;
        }
        setCurrentCardIndex(0);
        setIsFlipped(false);
        setCurrentPage('study');
      };

      // ë¬¸ì œí’€ì´
      const startTest = (mode) => {
        if (words.length < 4) {
          alert('ìµœì†Œ 4ê°œì˜ ë‹¨ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤!');
          return;
        }

        setTestMode(mode);
        const shuffled = [...words].sort(() => Math.random() - 0.5);
        // ëœë¤ í€´ì¦ˆì—ì„œ í˜¸ì¶œë˜ë©´ 5ë¬¸ì œ, ì•„ë‹ˆë©´ 10ë¬¸ì œ
        const questionCount = currentPage === 'randomQuiz' ? 5 : 10;
        const questions = shuffled.slice(0, Math.min(questionCount, words.length));
        
        if (mode === 'multiple') {
          const questionsWithOptions = questions.map(q => {
            const wrongAnswers = words
              .filter(w => w.id !== q.id)
              .sort(() => Math.random() - 0.5)
              .slice(0, 3)
              .map(w => w.korean);
            
            const options = [q.korean, ...wrongAnswers].sort(() => Math.random() - 0.5);
            return { ...q, options };
          });
          setTestQuestions(questionsWithOptions);
        } else {
          setTestQuestions(questions);
        }
        
        setCurrentQuestionIndex(0);
        setUserAnswer('');
        setShowAnswer(false);
        setTestResults([]);
        setCurrentPage('test');
      };

      const submitAnswer = () => {
        const currentQ = testQuestions[currentQuestionIndex];
        const isCorrect = testMode === 'multiple'
          ? userAnswer === currentQ.korean
          : userAnswer.toLowerCase().trim() === currentQ.english.toLowerCase().trim();

        setTestResults([...testResults, {
          word: currentQ,
          userAnswer,
          isCorrect
        }]);

        const quality = isCorrect ? 5 : 0;
        updateSpacedRepetition(currentQ.id, quality);

        setWords(words.map(w => {
          if (w.id === currentQ.id) {
            return {
              ...w,
              learnCount: w.learnCount + 1,
              correctCount: w.correctCount + (isCorrect ? 1 : 0),
              wrongCount: (w.wrongCount || 0) + (isCorrect ? 0 : 1)
            };
          }
          return w;
        }));

        // í•™ìŠµ ê¸°ë¡ ì €ì¥
        recordStudy(1, isCorrect ? 1 : 0);

        setShowAnswer(true);
      };

      const nextQuestion = () => {
        if (currentQuestionIndex < testQuestions.length - 1) {
          setCurrentQuestionIndex(currentQuestionIndex + 1);
          setUserAnswer('');
          setShowAnswer(false);
        } else {
          setCurrentPage('testResult');
        }
      };

      // í†µê³„
      const getStats = () => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const todayWords = words.filter(w => {
          if (!w.lastReviewed) return false;
          const reviewDate = new Date(w.lastReviewed);
          reviewDate.setHours(0, 0, 0, 0);
          return reviewDate.getTime() === today.getTime();
        });

        const totalLearnCount = words.reduce((sum, w) => sum + w.learnCount, 0);
        const totalCorrect = words.reduce((sum, w) => sum + w.correctCount, 0);
        const accuracy = totalLearnCount > 0 ? Math.round((totalCorrect / totalLearnCount) * 100) : 0;

        const byDifficulty = {
          beginner: words.filter(w => w.difficulty === 'beginner').length,
          intermediate: words.filter(w => w.difficulty === 'intermediate').length,
          advanced: words.filter(w => w.difficulty === 'advanced').length
        };

        return {
          todayCount: todayWords.length,
          totalWords: words.length,
          accuracy,
          dueWords: getDueWords().length,
          byDifficulty
        };
      };

      // AI ë¬´ì œí•œ ì¶”ì²œ (ì‹¤ì‹œê°„ ìƒì„±) - Gemini ì‚¬ìš©, 3ê°œë¡œ ì¶•ì†Œ
      const getRecommendations = async () => {
        setIsLoadingRecommendations(true);
        try {
          const stats = getStats();
          const weakDifficulties = [];

          Object.entries(stats.byDifficulty).forEach(([diff, count]) => {
            if (count < 10) weakDifficulties.push(diff);
          });

          // ì´ë¯¸ ë“±ë¡ëœ ë‹¨ì–´ ëª©ë¡
          const registeredWords = words.map(w => w.english.toLowerCase());

          const prompt = `ì‚¬ìš©ìì˜ ì˜ë‹¨ì–´ í•™ìŠµ ë¶„ì„:

**í˜„ì¬ í†µê³„:**
- ì´ ë‹¨ì–´ ìˆ˜: ${stats.totalWords}ê°œ
- ì „ì²´ ì •ë‹µë¥ : ${stats.accuracy}%
- ë‚œì´ë„ë³„ í˜„í™©:
  â€¢ ì´ˆê¸‰: ${stats.byDifficulty.beginner}ê°œ
  â€¢ ì¤‘ê¸‰: ${stats.byDifficulty.intermediate}ê°œ
  â€¢ ê³ ê¸‰: ${stats.byDifficulty.advanced}ê°œ
- ë¶€ì¡±í•œ ë‚œì´ë„: ${weakDifficulties.join(', ') || 'ê· í˜• ì¡í˜'}

**ì´ë¯¸ ë“±ë¡ëœ ë‹¨ì–´ (ì¤‘ë³µ ì œì™¸):**
${registeredWords.slice(0, 50).join(', ')}${registeredWords.length > 50 ? '...' : ''}

ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ **ì‹¤ìš©ì ì´ê³  ì¤‘ìš”í•œ** ì˜ë‹¨ì–´ 3ê°œë¥¼ ìƒˆë¡­ê²Œ ìƒì„±í•˜ì—¬ ì¶”ì²œí•´ì£¼ì„¸ìš”.

ì¶”ì²œ ê¸°ì¤€:
1. ìœ„ì— ë‚˜ì—´ëœ ë‹¨ì–´ë“¤ê³¼ **ì ˆëŒ€ ì¤‘ë³µë˜ì§€ ì•ŠëŠ”** ìƒˆë¡œìš´ ë‹¨ì–´
2. ë¶€ì¡±í•œ ë‚œì´ë„ ìš°ì„  ê³ ë ¤
3. ì‹¤ìƒí™œì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ë‹¨ì–´
4. í† ìµ, í† í”Œ, ìˆ˜ëŠ¥ ë“± ì‹œí—˜ì— ìì£¼ ë‚˜ì˜¤ëŠ” ë‹¨ì–´
5. ë‚œì´ë„ ê· í˜• ê³ ë ¤

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜:
{
  "recommendations": [
    {
      "english": "ë‹¨ì–´1",
      "korean": "í•œê¸€ ëœ»",
      "pronunciation": "í•œê¸€ ë°œìŒ",
      "phonetic": "IPA ë°œìŒê¸°í˜¸",
      "difficulty": "beginner/intermediate/advanced",
      "tags": ["ì ì ˆí•œ íƒœê·¸1", "ì ì ˆí•œ íƒœê·¸2"]
    },
    ... 3ê°œ
  ],
  "reason": "ì´ ë‹¨ì–´ë“¤ì„ ì¶”ì²œí•˜ëŠ” ì´ìœ ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ"
}

**íƒœê·¸ëŠ” ë‹¤ìŒ ì¤‘ì—ì„œ ì„ íƒ:** ë¹„ì¦ˆë‹ˆìŠ¤, ì—¬í–‰, ì‹œí—˜, ì¼ìƒ, ê¸°íƒ€

**ì¤‘ìš”: ë°˜ë“œì‹œ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”. ë‹¤ë¥¸ ì„¤ëª…ì´ë‚˜ ë§ˆí¬ë‹¤ìš´ ì—†ì´ ìˆœìˆ˜ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.**`;

          const response = await fetch("/.netlify/functions/gemini", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              prompt: prompt
            })
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || `API ì˜¤ë¥˜: ${response.status}`);
          }

          if (!data.text) {
            throw new Error('API ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜');
          }

          let responseText = data.text.trim();
          // JSON ì¶”ì¶œ (ë§ˆí¬ë‹¤ìš´ ì½”ë“œë¸”ë¡ ì œê±°)
          responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();

          const result = JSON.parse(responseText);
          
          // ì¤‘ë³µ ì²´í¬ (ì•ˆì „ì¥ì¹˜)
          const uniqueRecommendations = result.recommendations.filter(word => 
            !registeredWords.includes(word.english.toLowerCase())
          );

          setRecommendations({
            words: uniqueRecommendations,
            reason: result.reason
          });
        } catch (error) {
          console.error('AI ì¶”ì²œ ì˜¤ë¥˜:', error);
          alert('AI ì¶”ì²œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì˜¤ë¥˜: ' + (error.message || error));
          setRecommendations([]);
        } finally {
          setIsLoadingRecommendations(false);
        }
      };

      const addRecommendedWord = (word) => {
        const newWord = {
          id: Date.now(),
          ...word,
          learnCount: 0,
          correctCount: 0,
          lastReviewed: null,
          nextReview: new Date().toISOString(),
          easeFactor: 2.5,
          interval: 1
        };

        setWords([...words, newWord]);
        setRecommendations({
          ...recommendations,
          words: recommendations.words.filter(w => w.english !== word.english)
        });
      };

      // JSON ë‹¤ìš´ë¡œë“œ
      const downloadData = () => {
        const data = {
          words,
          exportDate: new Date().toISOString(),
          version: '1.0'
        };
        
        const jsonString = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `vocabulary_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      // JSON ì—…ë¡œë“œ
      const uploadData = (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            if (data.words && Array.isArray(data.words)) {
              setWords(data.words);
              alert(`${data.words.length}ê°œì˜ ë‹¨ì–´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!`);
            } else {
              alert('ì˜¬ë°”ë¥´ì§€ ì•Šì€ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
            }
          } catch (error) {
            alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
        };
        reader.readAsText(file);
      };

      // ìœ í‹¸ë¦¬í‹°
      const getDifficultyColor = (difficulty) => {
        const colors = {
          beginner: 'bg-green-100 text-green-800',
          intermediate: 'bg-yellow-100 text-yellow-800',
          advanced: 'bg-red-100 text-red-800'
        };
        return colors[difficulty] || colors.beginner;
      };

      const getDifficultyText = (difficulty) => {
        const text = {
          beginner: 'ì´ˆê¸‰',
          intermediate: 'ì¤‘ê¸‰',
          advanced: 'ê³ ê¸‰'
        };
        return text[difficulty] || 'ì´ˆê¸‰';
      };

      const NavButton = ({ page, label, icon }) => (
        <button
          onClick={() => setCurrentPage(page)}
          className={`flex items-center gap-2 px-4 py-2 rounded-lg transition ${
            currentPage === page ? 'bg-blue-500 text-white' : 'bg-gray-100 hover:bg-gray-200'
          }`}
        >
          {icon} {label}
        </button>
      );

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6">
          <div className="max-w-6xl mx-auto">
            {/* í—¤ë” */}
            <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
              <div className="flex items-center justify-between mb-6">
                <div className="flex items-center gap-3">
                  <span className="text-4xl">ğŸ“</span>
                  <div>
                    <h1 className="text-3xl font-bold text-gray-800">AI ë‹¨ì–´ ì•”ê¸°ì¥</h1>
                    <p className="text-sm text-green-600 font-semibold">ğŸ’¾ ìë™ ì €ì¥ | ğŸ¤– ë¬´ì œí•œ AI ìƒì„±</p>
                  </div>
                </div>
                <div className="flex items-center gap-4">
                  <div className="flex gap-2">
                    <button
                      onClick={downloadData}
                      className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition text-sm"
                      title="ë°±ì—…"
                    >
                      ğŸ’¾ ë°±ì—…
                    </button>
                    <label className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition cursor-pointer text-sm">
                      ğŸ“¤ ë³µì›
                      <input type="file" accept=".json" onChange={uploadData} className="hidden" />
                    </label>
                  </div>
                  <div className="text-right">
                    <p className="text-sm text-gray-600">ë‹¨ì–´</p>
                    <p className="text-2xl font-bold text-blue-500">{words.length}ê°œ</p>
                  </div>
                </div>
              </div>

              {/* ë„¤ë¹„ê²Œì´ì…˜ */}
              <div className="flex gap-3 flex-wrap">
                <NavButton page="list" icon="ğŸ“š" label="ëª©ë¡" />
                <NavButton page="add" icon="â•" label="ì¶”ê°€" />
                <button
                  onClick={startStudy}
                  className="flex items-center gap-2 px-4 py-2 rounded-lg transition bg-purple-500 text-white hover:bg-purple-600"
                >
                  ğŸ“– í•™ìŠµ
                </button>
                <NavButton page="testMenu" icon="âœï¸" label="ë¬¸ì œ" />
                <NavButton page="wrongNote" icon="ğŸ“" label="ì˜¤ë‹µë…¸íŠ¸" />
                <NavButton page="randomQuiz" icon="ğŸ²" label="ëœë¤í€´ì¦ˆ" />
                <NavButton page="stats" icon="ğŸ“Š" label="í†µê³„" />
                <button
                  onClick={() => {
                    setCurrentPage('recommend');
                    if (recommendations.length === 0) getRecommendations();
                  }}
                  className="flex items-center gap-2 px-4 py-2 rounded-lg transition bg-gradient-to-r from-pink-500 to-purple-500 text-white hover:from-pink-600 hover:to-purple-600"
                >
                  ğŸ¤– AI ì¶”ì²œ
                </button>
              </div>
            </div>

            {/* ë©”ì¸ ì»¨í…ì¸  */}
            <div className="bg-white rounded-2xl shadow-lg p-6">
              {/* ë‹¨ì–´ ëª©ë¡ */}
              {currentPage === 'list' && (
                <div>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-2xl font-bold">ğŸ“š ë‹¨ì–´ ëª©ë¡</h2>
                    {words.length > 0 && (
                      <input
                        type="text"
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        placeholder="ğŸ” ì˜ì–´ ë˜ëŠ” í•œê¸€ë¡œ ê²€ìƒ‰..."
                        className="px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none w-80"
                      />
                    )}
                  </div>

                  {/* íƒœê·¸ í•„í„° */}
                  {words.length > 0 && (
                    <div className="mb-4 space-y-2">
                      <div className="flex items-center gap-2 flex-wrap">
                        <span className="text-sm font-semibold text-gray-700">ğŸ·ï¸ íƒœê·¸:</span>
                        <button
                          onClick={() => setSelectedTagFilter('ì „ì²´')}
                          className={`px-3 py-1 rounded-lg text-sm font-semibold transition ${
                            selectedTagFilter === 'ì „ì²´'
                              ? 'bg-blue-500 text-white'
                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                          }`}
                        >
                          ì „ì²´
                        </button>
                        {availableTags.map(tag => (
                          <button
                            key={tag}
                            onClick={() => setSelectedTagFilter(tag)}
                            className={`px-3 py-1 rounded-lg text-sm font-semibold transition ${
                              selectedTagFilter === tag
                                ? 'bg-blue-500 text-white'
                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                            }`}
                          >
                            {tag}
                          </button>
                        ))}
                        <button
                          onClick={() => setShowFavoritesOnly(!showFavoritesOnly)}
                          className={`px-3 py-1 rounded-lg text-sm font-semibold transition ml-auto ${
                            showFavoritesOnly
                              ? 'bg-yellow-500 text-white'
                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                          }`}
                        >
                          â­ ì¦ê²¨ì°¾ê¸°ë§Œ
                        </button>
                      </div>
                    </div>
                  )}

                  {words.length === 0 ? (
                    <div className="text-center py-12 text-gray-400">
                      <p className="text-6xl mb-4">ğŸ“–</p>
                      <p>ë“±ë¡ëœ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                      <p className="text-sm">ë‹¨ì–´ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ AI ì¶”ì²œì„ ë°›ì•„ë³´ì„¸ìš”!</p>
                    </div>
                  ) : (
                    <div className="space-y-4">
                      {words
                        .filter(word => {
                          // ê²€ìƒ‰ í•„í„°
                          if (searchQuery.trim()) {
                            const query = searchQuery.toLowerCase();
                            const matchesSearch = word.english.toLowerCase().includes(query) ||
                                                 word.korean.toLowerCase().includes(query);
                            if (!matchesSearch) return false;
                          }

                          // íƒœê·¸ í•„í„°
                          if (selectedTagFilter !== 'ì „ì²´') {
                            const wordTags = word.tags || [];
                            if (!wordTags.includes(selectedTagFilter)) return false;
                          }

                          // ì¦ê²¨ì°¾ê¸° í•„í„°
                          if (showFavoritesOnly && !word.isFavorite) return false;

                          return true;
                        })
                        .map(word => (
                        <div key={word.id} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                          <div className="flex justify-between items-start">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-2 flex-wrap">
                                <h3 className="text-xl font-bold">{word.english}</h3>
                                <span className={`px-3 py-1 rounded-full text-xs font-semibold ${getDifficultyColor(word.difficulty)}`}>
                                  {getDifficultyText(word.difficulty)}
                                </span>
                                {word.tags && word.tags.length > 0 && word.tags.map(tag => (
                                  <span key={tag} className="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-semibold">
                                    ğŸ·ï¸ {tag}
                                  </span>
                                ))}
                              </div>
                              <p className="text-lg mb-1">ğŸ‡°ğŸ‡· {word.korean}</p>
                              {word.pronunciation && <p className="text-sm text-gray-500 mb-1">ğŸ”Š {word.pronunciation}{word.phonetic && <span className="ml-2 text-blue-600">{word.phonetic}</span>}</p>}
                              {word.example && <p className="text-sm text-gray-600 italic bg-gray-50 p-2 rounded">ğŸ’¬ {word.example}</p>}
                            </div>
                            <div className="flex gap-2">
                              <button
                                onClick={() => toggleFavorite(word.id)}
                                className={`p-2 rounded-lg transition ${word.isFavorite ? 'text-yellow-500 hover:bg-yellow-50' : 'text-gray-400 hover:bg-gray-50'}`}
                                title="ì¦ê²¨ì°¾ê¸°"
                              >
                                {word.isFavorite ? 'â­' : 'â˜†'}
                              </button>
                              <button
                                onClick={() => copyWord(word)}
                                className="text-blue-500 hover:bg-blue-50 p-2 rounded-lg transition"
                                title="ë³µì‚¬"
                              >
                                ğŸ“‹
                              </button>
                              <button
                                onClick={() => deleteWord(word.id)}
                                className="text-red-500 hover:bg-red-50 p-2 rounded-lg transition"
                                title="ì‚­ì œ"
                              >
                                ğŸ—‘ï¸
                              </button>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}

              {/* ë‹¨ì–´ ì¶”ê°€ */}
              {currentPage === 'add' && (
                <div>
                  <h2 className="text-2xl font-bold mb-4">â• ë‹¨ì–´ ì¶”ê°€</h2>
                  
                  {/* ë²ˆì—­ ëª¨ë“œ ì„ íƒ */}
                  <div className="mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border-2 border-blue-200">
                    <p className="text-sm font-semibold mb-3 text-gray-700">ğŸ”„ ë²ˆì—­ ë°©í–¥ ì„ íƒ</p>
                    <div className="flex gap-3 mb-4">
                      <button
                        onClick={() => setTranslationMode('en-to-ko')}
                        className={`flex-1 py-3 rounded-lg font-semibold transition ${
                          translationMode === 'en-to-ko'
                            ? 'bg-blue-500 text-white'
                            : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        ğŸ‡¬ğŸ‡§ ì˜ì–´ â†’ í•œê¸€
                      </button>
                      <button
                        onClick={() => setTranslationMode('ko-to-en')}
                        className={`flex-1 py-3 rounded-lg font-semibold transition ${
                          translationMode === 'ko-to-en'
                            ? 'bg-blue-500 text-white'
                            : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        ğŸ‡°ğŸ‡· í•œê¸€ â†’ ì˜ì–´
                      </button>
                    </div>

                    {/* ì˜ˆë¬¸ í¬í•¨ ì˜µì…˜ */}
                    <label className="flex items-center gap-2 cursor-pointer bg-white p-3 rounded-lg hover:bg-gray-50 transition">
                      <input
                        type="checkbox"
                        checked={includeExample}
                        onChange={(e) => setIncludeExample(e.target.checked)}
                        className="w-5 h-5"
                      />
                      <span className="text-sm font-semibold text-gray-700">
                        ğŸ“ ì˜ˆë¬¸ í¬í•¨ (API ë¹„ìš© ì¦ê°€)
                      </span>
                    </label>
                  </div>

                  <div className="space-y-4">
                    {translationMode === 'en-to-ko' ? (
                      <>
                        {/* ì˜ì–´ â†’ í•œê¸€ ëª¨ë“œ */}
                        <div>
                          <label className="block text-sm font-semibold mb-2">ì˜ë‹¨ì–´ *</label>
                          <div className="flex gap-2">
                            <input
                              type="text"
                              value={newWord.english}
                              onChange={(e) => setNewWord({...newWord, english: e.target.value})}
                              onKeyPress={(e) => e.key === 'Enter' && !isTranslating && newWord.english.trim() && translateWord()}
                              className="flex-1 px-4 py-2 border rounded-lg"
                              placeholder="ì˜ˆ: ephemeral"
                            />
                            <button
                              onClick={translateWord}
                              disabled={isTranslating}
                              className="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition disabled:bg-gray-300"
                            >
                              {isTranslating ? 'ë²ˆì—­ì¤‘...' : 'ğŸŒ ë²ˆì—­'}
                            </button>
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-2">í•œêµ­ì–´ ëœ» *</label>
                          <input
                            type="text"
                            value={newWord.korean}
                            onChange={(e) => setNewWord({...newWord, korean: e.target.value})}
                            className="w-full px-4 py-2 border rounded-lg"
                          />
                        </div>
                      </>
                    ) : (
                      <>
                        {/* í•œê¸€ â†’ ì˜ì–´ ëª¨ë“œ */}
                        <div>
                          <label className="block text-sm font-semibold mb-2">í•œêµ­ì–´ ëœ» *</label>
                          <div className="flex gap-2">
                            <input
                              type="text"
                              value={newWord.korean}
                              onChange={(e) => setNewWord({...newWord, korean: e.target.value})}
                              onKeyPress={(e) => e.key === 'Enter' && !isTranslating && newWord.korean.trim() && translateWord()}
                              className="flex-1 px-4 py-2 border rounded-lg"
                              placeholder="ì˜ˆ: ì¼ì‹œì ì¸, ë§ì—†ëŠ”"
                            />
                            <button
                              onClick={translateWord}
                              disabled={isTranslating}
                              className="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition disabled:bg-gray-300"
                            >
                              {isTranslating ? 'ë²ˆì—­ì¤‘...' : 'ğŸŒ ë²ˆì—­'}
                            </button>
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-2">ì˜ë‹¨ì–´ *</label>
                          <input
                            type="text"
                            value={newWord.english}
                            onChange={(e) => setNewWord({...newWord, english: e.target.value})}
                            className="w-full px-4 py-2 border rounded-lg"
                          />
                        </div>
                      </>
                    )}

                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-semibold mb-2">í•œê¸€ ë°œìŒ</label>
                        <input
                          type="text"
                          value={newWord.pronunciation}
                          onChange={(e) => setNewWord({...newWord, pronunciation: e.target.value})}
                          className="w-full px-4 py-2 border rounded-lg"
                          placeholder="ì˜ˆ: ì´í˜ë¨¸ëŸ´"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">ë°œìŒê¸°í˜¸ (IPA)</label>
                        <input
                          type="text"
                          value={newWord.phonetic}
                          onChange={(e) => setNewWord({...newWord, phonetic: e.target.value})}
                          className="w-full px-4 py-2 border rounded-lg"
                          placeholder="ì˜ˆ: /ÉªËˆfÉ›mÉ™rÉ™l/"
                        />
                      </div>
                    </div>
                    <div>
                      <label className="block text-sm font-semibold mb-2">ì˜ˆë¬¸</label>
                      <textarea
                        value={newWord.example}
                        onChange={(e) => setNewWord({...newWord, example: e.target.value})}
                        className="w-full px-4 py-2 border rounded-lg"
                        rows="3"
                        placeholder="ì˜ˆ: The beauty of cherry blossoms is ephemeral."
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-semibold mb-2">ë‚œì´ë„</label>
                      <select
                        value={newWord.difficulty}
                        onChange={(e) => setNewWord({...newWord, difficulty: e.target.value})}
                        className="w-full px-4 py-2 border rounded-lg"
                      >
                        <option value="beginner">ì´ˆê¸‰</option>
                        <option value="intermediate">ì¤‘ê¸‰</option>
                        <option value="advanced">ê³ ê¸‰</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-semibold mb-2">ğŸ·ï¸ íƒœê·¸ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
                      <div className="flex flex-wrap gap-2">
                        {availableTags.map(tag => (
                          <button
                            key={tag}
                            type="button"
                            onClick={() => {
                              const newTags = newWord.tags.includes(tag)
                                ? newWord.tags.filter(t => t !== tag)
                                : [...newWord.tags, tag];
                              setNewWord({...newWord, tags: newTags});
                            }}
                            className={`px-4 py-2 rounded-lg font-semibold transition ${
                              newWord.tags.includes(tag)
                                ? 'bg-blue-500 text-white'
                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                            }`}
                          >
                            {tag}
                          </button>
                        ))}
                      </div>
                    </div>
                    <div className="flex gap-3 pt-4">
                      <button
                        onClick={addWord}
                        className="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition font-semibold"
                      >
                        ë‹¨ì–´ ì¶”ê°€
                      </button>
                      <button
                        onClick={() => setCurrentPage('list')}
                        className="px-6 bg-gray-200 py-3 rounded-lg hover:bg-gray-300 transition font-semibold"
                      >
                        ì·¨ì†Œ
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* í•™ìŠµ ëª¨ë“œ */}
              {currentPage === 'study' && words.length > 0 && (
                <div>
                  <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold">ğŸ“– í•™ìŠµ ëª¨ë“œ</h2>
                    <div className="text-sm text-gray-600">
                      {currentCardIndex + 1} / {words.length}
                    </div>
                  </div>

                  <div className="max-w-2xl mx-auto">
                    <div 
                      onClick={flipCard}
                      className={`flip-card ${isFlipped ? 'flipped' : ''} cursor-pointer mb-8`}
                    >
                      <div className="flip-card-inner relative h-96">
                        <div className="flip-card-front absolute w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl shadow-2xl flex items-center justify-center p-8">
                          <div className="text-center text-white">
                            <p className="text-6xl font-bold mb-4">{words[currentCardIndex].english}</p>
                            <span className={`px-4 py-2 rounded-full text-sm font-semibold ${getDifficultyColor(words[currentCardIndex].difficulty)}`}>
                              {getDifficultyText(words[currentCardIndex].difficulty)}
                            </span>
                            <p className="mt-8 text-white/70">ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ ëœ» ë³´ê¸°</p>
                          </div>
                        </div>

                        <div className="flip-card-back absolute w-full h-full bg-gradient-to-br from-green-500 to-teal-600 rounded-2xl shadow-2xl p-8">
                          <div className="text-white h-full flex flex-col justify-center">
                            <h3 className="text-4xl font-bold mb-4 text-center">{words[currentCardIndex].english}</h3>
                            <div className="space-y-4 bg-white/10 rounded-xl p-6 backdrop-blur">
                              <div>
                                <p className="text-sm opacity-80">í•œêµ­ì–´ ëœ»</p>
                                <p className="text-2xl font-semibold">{words[currentCardIndex].korean}</p>
                              </div>
                              {words[currentCardIndex].pronunciation && (
                                <div>
                                  <p className="text-sm opacity-80">ë°œìŒ</p>
                                  <p className="text-xl">{words[currentCardIndex].pronunciation}</p>
                                </div>
                              )}
                              {words[currentCardIndex].example && (
                                <div>
                                  <p className="text-sm opacity-80">ì˜ˆë¬¸</p>
                                  <p className="text-lg italic">{words[currentCardIndex].example}</p>
                                </div>
                              )}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div className="flex justify-between items-center mb-4">
                      <button onClick={prevCard} className="px-6 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">â† ì´ì „</button>
                      <button onClick={flipCard} className="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold">ì¹´ë“œ ë’¤ì§‘ê¸°</button>
                      <button onClick={nextCard} className="px-6 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">ë‹¤ìŒ â†’</button>
                    </div>

                    {isFlipped && (
                      <div className="p-4 bg-gray-50 rounded-xl mb-4">
                        <p className="text-sm text-gray-600 mb-3 text-center">ì–¼ë§ˆë‚˜ ì˜ ê¸°ì–µí•˜ì…¨ë‚˜ìš”?</p>
                        <div className="grid grid-cols-3 gap-2">
                          <button onClick={() => markCardQuality(0)} className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm">âŒ ëª¨ë¦„</button>
                          <button onClick={() => markCardQuality(3)} className="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 text-sm">ğŸ¤” ì–´ë ¤ì›€</button>
                          <button onClick={() => markCardQuality(5)} className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm">âœ… ì™„ë²½</button>
                        </div>
                      </div>
                    )}

                    <button onClick={() => setCurrentPage('list')} className="w-full px-6 py-3 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg font-semibold">í•™ìŠµ ì¢…ë£Œ</button>
                  </div>
                </div>
              )}

              {/* ë¬¸ì œí’€ì´ ë©”ë‰´ */}
              {currentPage === 'testMenu' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">âœï¸ ë¬¸ì œí’€ì´ ëª¨ë“œ</h2>
                  <div className="grid md:grid-cols-2 gap-6 max-w-3xl mx-auto">
                    <div onClick={() => startTest('multiple')} className="bg-gradient-to-br from-blue-50 to-blue-100 p-8 rounded-2xl border-2 border-blue-200 hover:border-blue-400 cursor-pointer transition hover:shadow-lg">
                      <div className="text-5xl mb-4">ğŸ“</div>
                      <h3 className="text-2xl font-bold mb-2">ê°ê´€ì‹</h3>
                      <p className="text-gray-600">4ê°œì˜ ë³´ê¸° ì¤‘ ì •ë‹µ ì„ íƒ</p>
                    </div>
                    <div onClick={() => startTest('written')} className="bg-gradient-to-br from-green-50 to-green-100 p-8 rounded-2xl border-2 border-green-200 hover:border-green-400 cursor-pointer transition hover:shadow-lg">
                      <div className="text-5xl mb-4">âœï¸</div>
                      <h3 className="text-2xl font-bold mb-2">ì£¼ê´€ì‹</h3>
                      <p className="text-gray-600">ëœ»ì„ ë³´ê³  ì˜ë‹¨ì–´ ì…ë ¥</p>
                    </div>
                  </div>
                </div>
              )}

              {/* ë¬¸ì œí’€ì´ */}
              {currentPage === 'test' && testQuestions.length > 0 && (
                <div>
                  <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold">{testMode === 'multiple' ? 'ğŸ“ ê°ê´€ì‹' : 'âœï¸ ì£¼ê´€ì‹'}</h2>
                    <div className="text-sm text-gray-600">{currentQuestionIndex + 1} / {testQuestions.length}</div>
                  </div>

                  <div className="max-w-2xl mx-auto">
                    <div className="bg-gradient-to-br from-purple-50 to-pink-50 p-8 rounded-2xl border-2 border-purple-200 mb-6">
                      {testMode === 'multiple' ? (
                        <>
                          <p className="text-gray-600 mb-4">ë‹¤ìŒ ë‹¨ì–´ì˜ ëœ»ì€?</p>
                          <h3 className="text-4xl font-bold mb-6">{testQuestions[currentQuestionIndex].english}</h3>
                          <div className="space-y-3">
                            {testQuestions[currentQuestionIndex].options.map((option, idx) => (
                              <button
                                key={idx}
                                onClick={() => !showAnswer && setUserAnswer(option)}
                                disabled={showAnswer}
                                className={`w-full p-4 rounded-lg text-left transition ${
                                  showAnswer
                                    ? option === testQuestions[currentQuestionIndex].korean
                                      ? 'bg-green-500 text-white'
                                      : userAnswer === option ? 'bg-red-500 text-white' : 'bg-gray-100'
                                    : userAnswer === option ? 'bg-blue-500 text-white' : 'bg-white hover:bg-gray-50 border-2 border-gray-200'
                                }`}
                              >
                                {option}
                              </button>
                            ))}
                          </div>
                        </>
                      ) : (
                        <>
                          <p className="text-gray-600 mb-4">ë‹¤ìŒ ëœ»ì— í•´ë‹¹í•˜ëŠ” ì˜ë‹¨ì–´ëŠ”?</p>
                          <h3 className="text-3xl font-bold mb-6">{testQuestions[currentQuestionIndex].korean}</h3>
                          {testQuestions[currentQuestionIndex].pronunciation && (
                            <p className="text-gray-600 mb-4">ë°œìŒ: {testQuestions[currentQuestionIndex].pronunciation}</p>
                          )}
                          <input
                            type="text"
                            value={userAnswer}
                            onChange={(e) => setUserAnswer(e.target.value)}
                            disabled={showAnswer}
                            className="w-full p-4 text-2xl border-2 rounded-lg"
                            placeholder="ì˜ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                            onKeyPress={(e) => e.key === 'Enter' && !showAnswer && userAnswer && submitAnswer()}
                          />
                        </>
                      )}
                    </div>

                    {showAnswer && (
                      <div className={`p-6 rounded-xl mb-6 ${testResults[testResults.length - 1].isCorrect ? 'bg-green-100 border-2 border-green-500' : 'bg-red-100 border-2 border-red-500'}`}>
                        <p className="text-2xl font-bold mb-2">{testResults[testResults.length - 1].isCorrect ? 'âœ… ì •ë‹µ!' : 'âŒ ì˜¤ë‹µ'}</p>
                        <p className="text-lg">ì •ë‹µ: <strong>{testQuestions[currentQuestionIndex][testMode === 'multiple' ? 'korean' : 'english']}</strong></p>
                      </div>
                    )}

                    <div className="flex gap-3">
                      {!showAnswer ? (
                        <button onClick={submitAnswer} disabled={!userAnswer} className="flex-1 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 font-semibold disabled:bg-gray-300">ì œì¶œ</button>
                      ) : (
                        <button onClick={nextQuestion} className="flex-1 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold">
                          {currentQuestionIndex < testQuestions.length - 1 ? 'ë‹¤ìŒ ë¬¸ì œ' : 'ê²°ê³¼ ë³´ê¸°'}
                        </button>
                      )}
                      <button onClick={() => setCurrentPage('testMenu')} className="px-6 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">ì¢…ë£Œ</button>
                    </div>
                  </div>
                </div>
              )}

              {/* í…ŒìŠ¤íŠ¸ ê²°ê³¼ */}
              {currentPage === 'testResult' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6 text-center">ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
                  <div className="max-w-2xl mx-auto">
                    <div className="bg-gradient-to-br from-blue-500 to-purple-600 text-white p-8 rounded-2xl mb-6 text-center">
                      <p className="text-xl mb-2">ì´ {testResults.length}ë¬¸ì œ</p>
                      <p className="text-5xl font-bold mb-2">{testResults.filter(r => r.isCorrect).length} / {testResults.length}</p>
                      <p className="text-2xl">ì •ë‹µë¥ : {Math.round((testResults.filter(r => r.isCorrect).length / testResults.length) * 100)}%</p>
                    </div>

                    <div className="space-y-3 mb-6">
                      {testResults.map((result, idx) => (
                        <div key={idx} className={`p-4 rounded-lg border-2 ${result.isCorrect ? 'bg-green-50 border-green-300' : 'bg-red-50 border-red-300'}`}>
                          <p className="font-bold text-lg">{result.isCorrect ? 'âœ…' : 'âŒ'} {result.word.english}</p>
                          <p className="text-gray-600">ì •ë‹µ: {testMode === 'multiple' ? result.word.korean : result.word.english}</p>
                          {!result.isCorrect && <p className="text-red-600 text-sm">ì…ë ¥: {result.userAnswer}</p>}
                        </div>
                      ))}
                    </div>

                    <div className="flex gap-3">
                      <button onClick={() => startTest(testMode)} className="flex-1 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold">ë‹¤ì‹œ í’€ê¸°</button>
                      <button onClick={() => setCurrentPage('testMenu')} className="flex-1 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold">ë©”ë‰´ë¡œ</button>
                    </div>
                  </div>
                </div>
              )}

              {/* í†µê³„ */}
              {currentPage === 'stats' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">ğŸ“Š í•™ìŠµ í†µê³„</h2>
                  {(() => {
                    const stats = getStats();
                    return (
                      <div className="max-w-4xl mx-auto space-y-6">
                        <div className="grid md:grid-cols-4 gap-4">
                          <div className="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">ì˜¤ëŠ˜ í•™ìŠµ</p>
                            <p className="text-4xl font-bold">{stats.todayCount}</p>
                            <p className="text-sm opacity-80">ë‹¨ì–´</p>
                          </div>
                          <div className="bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">ì „ì²´ ì •ë‹µë¥ </p>
                            <p className="text-4xl font-bold">{stats.accuracy}%</p>
                          </div>
                          <div className="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">ì´ ë‹¨ì–´</p>
                            <p className="text-4xl font-bold">{stats.totalWords}</p>
                          </div>
                          <div className="bg-gradient-to-br from-orange-500 to-orange-600 text-white p-6 rounded-xl">
                            <p className="text-sm opacity-80 mb-1">ë³µìŠµ í•„ìš”</p>
                            <p className="text-4xl font-bold">{stats.dueWords}</p>
                          </div>
                        </div>

                        <div className="bg-white p-6 rounded-xl border-2">
                          <h3 className="text-xl font-bold mb-4">ğŸ“ˆ ë‚œì´ë„ë³„ ë¶„í¬</h3>
                          <div className="space-y-3">
                            {Object.entries(stats.byDifficulty).map(([diff, count]) => (
                              <div key={diff} className="flex items-center gap-3">
                                <div className="w-24 text-sm font-semibold">{getDifficultyText(diff)}</div>
                                <div className="flex-1 bg-gray-200 rounded-full h-8">
                                  <div 
                                    className={`h-8 rounded-full flex items-center justify-end pr-3 text-white font-semibold text-sm ${
                                      diff === 'beginner' ? 'bg-green-500' : diff === 'intermediate' ? 'bg-yellow-500' : 'bg-red-500'
                                    }`}
                                    style={{ width: `${stats.totalWords > 0 ? (count / stats.totalWords) * 100 : 0}%` }}
                                  >
                                    {count}ê°œ
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* í•™ìŠµ ê·¸ë˜í”„ */}
                        <div className="bg-white p-6 rounded-xl border-2">
                          <h3 className="text-xl font-bold mb-4">ğŸ“ˆ ìµœê·¼ 7ì¼ í•™ìŠµ ê¸°ë¡</h3>
                          {(() => {
                            const last7Days = [];
                            for (let i = 6; i >= 0; i--) {
                              const date = new Date();
                              date.setDate(date.getDate() - i);
                              const dateStr = date.toISOString().split('T')[0];
                              const dayData = studyHistory[dateStr] || { count: 0, accuracy: 0 };
                              last7Days.push({
                                date: dateStr,
                                day: ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()],
                                ...dayData
                              });
                            }
                            const maxCount = Math.max(...last7Days.map(d => d.count), 1);

                            return (
                              <div className="space-y-4">
                                <div className="flex items-end justify-between gap-2 h-48">
                                  {last7Days.map((day, idx) => (
                                    <div key={idx} className="flex-1 flex flex-col items-center gap-2">
                                      <div className="flex-1 flex flex-col justify-end w-full">
                                        {day.count > 0 && (
                                          <div className="relative group">
                                            <div
                                              className="bg-gradient-to-t from-blue-500 to-blue-400 rounded-t hover:from-blue-600 hover:to-blue-500 transition cursor-pointer"
                                              style={{ height: `${(day.count / maxCount) * 160}px`, minHeight: day.count > 0 ? '20px' : '0' }}
                                            >
                                              <div className="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap">
                                                {day.count}ë¬¸ì œ ({day.accuracy}%)
                                              </div>
                                            </div>
                                          </div>
                                        )}
                                      </div>
                                      <div className="text-xs font-semibold text-gray-600">{day.day}</div>
                                      <div className="text-xs text-gray-400">{day.date.slice(5)}</div>
                                    </div>
                                  ))}
                                </div>
                                <div className="text-sm text-gray-600 text-center">
                                  ì´ {last7Days.reduce((sum, d) => sum + d.count, 0)}ë¬¸ì œ í•™ìŠµ
                                </div>
                              </div>
                            );
                          })()}
                        </div>

                        {getDueWords().length > 0 && (
                          <div className="bg-orange-50 p-6 rounded-xl border-2 border-orange-300">
                            <h3 className="text-xl font-bold mb-4">ğŸ”” ë³µìŠµ í•„ìš” ë‹¨ì–´</h3>
                            <div className="space-y-2 max-h-64 overflow-y-auto">
                              {getDueWords().map(word => (
                                <div key={word.id} className="bg-white p-3 rounded-lg border">
                                  <span className="font-bold">{word.english}</span> - {word.korean}
                                </div>
                              ))}
                            </div>
                            <button onClick={startStudy} className="w-full mt-4 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-semibold">ì§€ê¸ˆ ë³µìŠµí•˜ê¸°</button>
                          </div>
                        )}
                      </div>
                    );
                  })()}
                </div>
              )}

              {/* AI ë¬´ì œí•œ ì¶”ì²œ */}
              {currentPage === 'recommend' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">ğŸ¤– AI ë¬´ì œí•œ ë‹¨ì–´ ì¶”ì²œ</h2>
                  <div className="max-w-3xl mx-auto">
                    {recommendations.length === 0 ? (
                      <div className="text-center py-12">
                        <div className="text-6xl mb-4">ğŸ¤–</div>
                        <h3 className="text-xl font-bold mb-4">
                          AIê°€ í•™ìŠµ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬<br />
                          <span className="text-pink-600">ë¬´ì œí•œìœ¼ë¡œ</span> ìƒˆë¡œìš´ ë‹¨ì–´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                        </h3>
                        <p className="text-gray-600 mb-6">
                          ì‹¤ì‹œê°„ìœ¼ë¡œ ë§ì¶¤í˜• ë‹¨ì–´ë¥¼ ì¶”ì²œë°›ìœ¼ì„¸ìš”!
                        </p>
                        <button
                          onClick={getRecommendations}
                          disabled={isLoadingRecommendations}
                          className="px-8 py-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-xl hover:from-pink-600 hover:to-purple-700 font-semibold text-lg disabled:opacity-50"
                        >
                          {isLoadingRecommendations ? 'ğŸ”„ AI ë¶„ì„ ì¤‘...' : 'âœ¨ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë‹¨ì–´ ë°›ê¸°'}
                        </button>
                      </div>
                    ) : (
                      <div>
                        <div className="bg-gradient-to-r from-pink-50 to-purple-50 p-6 rounded-xl border-2 border-purple-200 mb-6">
                          <p className="text-gray-700"><strong>ğŸ’¡ AI ì¶”ì²œ ì´ìœ :</strong> {recommendations.reason}</p>
                        </div>

                        <div className="space-y-4 mb-6">
                          {recommendations.words && recommendations.words.map((word, idx) => (
                            <div key={idx} className="bg-white p-6 rounded-xl border-2 hover:border-purple-400 transition">
                              <div className="flex items-center gap-3 mb-2">
                                <h3 className="text-2xl font-bold">{word.english}</h3>
                                <span className={`px-3 py-1 rounded-full text-xs font-semibold ${getDifficultyColor(word.difficulty)}`}>
                                  {getDifficultyText(word.difficulty)}
                                </span>
                              </div>
                              <p className="text-lg mb-2">ğŸ‡°ğŸ‡· {word.korean}</p>
                              <p className="text-sm text-gray-500 mb-2">ğŸ”Š {word.pronunciation}{word.phonetic && <span className="ml-2 text-blue-600">{word.phonetic}</span>}</p>
                              {word.example && <p className="text-sm text-gray-600 italic bg-gray-50 p-3 rounded mb-3">ğŸ’¬ {word.example}</p>}
                              <button
                                onClick={() => addRecommendedWord(word)}
                                className="w-full py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 font-semibold"
                              >
                                â• ë‹¨ì–´ì¥ì— ì¶”ê°€
                              </button>
                            </div>
                          ))}
                        </div>

                        <button
                          onClick={getRecommendations}
                          disabled={isLoadingRecommendations}
                          className="w-full py-3 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold disabled:opacity-50"
                        >
                          {isLoadingRecommendations ? 'ğŸ”„ AI ë¶„ì„ ì¤‘...' : 'ğŸ”„ ë‹¤ë¥¸ ë‹¨ì–´ ì¶”ì²œ ë°›ê¸° (ë¬´ì œí•œ)'}
                        </button>

                        <div className="mt-6 p-4 bg-green-50 rounded-lg border border-green-200">
                          <p className="text-sm text-gray-700 text-center">
                            âœ¨ <strong>ë¬´ì œí•œ ìƒì„±:</strong> AIê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒˆë¡œìš´ ë‹¨ì–´ë¥¼ ê³„ì† ì¶”ì²œí•©ë‹ˆë‹¤!
                          </p>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* ì˜¤ë‹µë…¸íŠ¸ */}
              {currentPage === 'wrongNote' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">ğŸ“ ì˜¤ë‹µë…¸íŠ¸</h2>
                  {(() => {
                    const wrongWords = words.filter(w => (w.wrongCount || 0) > 0).sort((a, b) => (b.wrongCount || 0) - (a.wrongCount || 0));

                    if (wrongWords.length === 0) {
                      return (
                        <div className="text-center py-12 text-gray-400">
                          <p className="text-6xl mb-4">âœ…</p>
                          <p className="text-lg">í‹€ë¦° ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤!</p>
                          <p className="text-sm">ë¬¸ì œë¥¼ í’€ë©´ ì˜¤ë‹µ ë‹¨ì–´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                        </div>
                      );
                    }

                    return (
                      <div>
                        <div className="bg-red-50 p-4 rounded-lg mb-6 border-2 border-red-200">
                          <p className="text-sm text-gray-700">
                            ğŸ’¡ <strong>ì˜¤ë‹µ íšŸìˆ˜ê°€ ë§ì€ ë‹¨ì–´ë¶€í„°</strong> í‘œì‹œë©ë‹ˆë‹¤. ì§‘ì¤‘ í•™ìŠµì´ í•„ìš”í•œ ë‹¨ì–´ë“¤ì…ë‹ˆë‹¤!
                          </p>
                        </div>

                        <div className="space-y-4">
                          {wrongWords.map(word => (
                            <div key={word.id} className="bg-white p-4 rounded-lg border-2 border-red-200 hover:shadow-md transition">
                              <div className="flex justify-between items-start">
                                <div className="flex-1">
                                  <div className="flex items-center gap-3 mb-2">
                                    <h3 className="text-xl font-bold">{word.english}</h3>
                                    <span className="px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold">
                                      âŒ {word.wrongCount}íšŒ ì˜¤ë‹µ
                                    </span>
                                    <span className={`px-3 py-1 rounded-full text-xs font-semibold ${getDifficultyColor(word.difficulty)}`}>
                                      {getDifficultyText(word.difficulty)}
                                    </span>
                                  </div>
                                  <p className="text-lg mb-1">ğŸ‡°ğŸ‡· {word.korean}</p>
                                  {word.pronunciation && <p className="text-sm text-gray-500 mb-1">ğŸ”Š {word.pronunciation}</p>}
                                  {word.example && <p className="text-sm text-gray-600 italic bg-gray-50 p-2 rounded">ğŸ’¬ {word.example}</p>}
                                  <p className="text-xs text-gray-500 mt-2">
                                    ì •ë‹µë¥ : {word.learnCount > 0 ? Math.round((word.correctCount / word.learnCount) * 100) : 0}% ({word.correctCount}/{word.learnCount})
                                  </p>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>

                        <button
                          onClick={() => startTest('multiple')}
                          className="w-full mt-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 font-semibold"
                        >
                          ğŸ”¥ ì˜¤ë‹µ ë‹¨ì–´ ì§‘ì¤‘ ë³µìŠµí•˜ê¸°
                        </button>
                      </div>
                    );
                  })()}
                </div>
              )}

              {/* ëœë¤ í€´ì¦ˆ */}
              {currentPage === 'randomQuiz' && (
                <div>
                  <h2 className="text-2xl font-bold mb-6">ğŸ² ëœë¤ í€´ì¦ˆ</h2>
                  {words.length < 5 ? (
                    <div className="text-center py-12 text-gray-400">
                      <p className="text-6xl mb-4">ğŸ“š</p>
                      <p className="text-lg">ìµœì†Œ 5ê°œì˜ ë‹¨ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤!</p>
                      <p className="text-sm">ë‹¨ì–´ë¥¼ ë” ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
                    </div>
                  ) : (
                    <div className="max-w-3xl mx-auto">
                      <div className="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border-2 border-purple-200 mb-6">
                        <h3 className="text-xl font-bold mb-2">âš¡ ë¹ ë¥¸ í•™ìŠµ ëª¨ë“œ</h3>
                        <p className="text-gray-700">
                          ë¬´ì‘ìœ„ë¡œ ì„ íƒëœ 5ë¬¸ì œë¥¼ í’€ì–´ë³´ì„¸ìš”! ê°„ë‹¨í•˜ê³  ë¹ ë¥´ê²Œ ì‹¤ë ¥ì„ ì²´í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                      </div>

                      <div className="grid md:grid-cols-2 gap-4">
                        <button
                          onClick={() => startTest('multiple')}
                          className="bg-gradient-to-br from-blue-50 to-blue-100 p-8 rounded-2xl border-2 border-blue-200 hover:border-blue-400 transition hover:shadow-lg"
                        >
                          <div className="text-5xl mb-4">ğŸ“</div>
                          <h3 className="text-2xl font-bold mb-2">ê°ê´€ì‹ í€´ì¦ˆ</h3>
                          <p className="text-gray-600">5ë¬¸ì œ ê°ê´€ì‹</p>
                        </button>
                        <button
                          onClick={() => startTest('written')}
                          className="bg-gradient-to-br from-green-50 to-green-100 p-8 rounded-2xl border-2 border-green-200 hover:border-green-400 transition hover:shadow-lg"
                        >
                          <div className="text-5xl mb-4">âœï¸</div>
                          <h3 className="text-2xl font-bold mb-2">ì£¼ê´€ì‹ í€´ì¦ˆ</h3>
                          <p className="text-gray-600">5ë¬¸ì œ ì£¼ê´€ì‹</p>
                        </button>
                      </div>

                      <div className="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <p className="text-sm text-gray-700 text-center">
                          ğŸ’¡ <strong>Tip:</strong> ë§¤ì¼ í€´ì¦ˆë¥¼ í’€ë©´ í•™ìŠµ ê·¸ë˜í”„ì— ê¸°ë¡ë©ë‹ˆë‹¤!
                        </p>
                      </div>
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<VocabApp />, document.getElementById('root'));
  </script>
</body>
</html>